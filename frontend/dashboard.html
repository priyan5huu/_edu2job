<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Security: Prevent caching of authenticated pages -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Edu2Job Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="css/global.css">
  <style>
    :root {
      --font-main: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      --font-heading: 'Space Grotesk', sans-serif;
      --color-bg: #eefbf3;
      --color-sidebar: #ffffff;
      --color-card-bg: #ffffff;
      --color-text-main: #0f172a;
      --color-text-muted: #64748b;
      --color-primary: #6366f1;
      --color-primary-hover: #4f46e5;
      --color-primary-light: #e0e7ff;
      --color-primary-dark: #3730a3;
      --color-border: #e2e8f0;
      --radius-lg: 24px;
      --radius-md: 16px;
      --radius-sm: 12px;
      --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
      --sidebar-width: 260px;
    }

    body {
      font-family: var(--font-main);
      background-color: var(--color-bg);
      color: var(--color-text-main);
      font-size: 14px;
      line-height: 1.5;
      height: 100vh;
      display: flex;
      overflow: hidden;
    }

    /* Mobile Navigation */
    @media (max-width: 768px) {
      .top-nav {
        padding: 16px !important;
        flex-direction: column;
        gap: 16px;
      }

      .nav-pills {
        width: 100%;
        overflow-x: auto;
        justify-content: center;
        padding: 4px;
      }

      .main-content {
        padding: 20px !important;
      }

      .logo-text {
        margin-bottom: 8px;
      }
    }

    /* Icons */
    .icon {
      width: 20px;
      height: 20px;
      stroke: currentColor;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
      fill: none;
    }

    /* Top Nav */
    .top-nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--color-card-bg);
      border-bottom: 1px solid var(--color-border);
      padding: 16px 32px;
      box-shadow: var(--shadow-md);
      position: sticky;
      top: 0;
      z-index: 50;
    }

    .nav-pills {
      display: flex;
      gap: 12px;
      background: var(--color-bg);
      padding: 8px;
      border-radius: 50px;
      border: 1px solid var(--color-border);
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .nav-pill {
      padding: 10px 24px;
      border-radius: 50px;
      text-decoration: none;
      color: var(--color-text-muted);
      font-weight: 600;
      transition: all 0.3s;
      font-size: 14px;
    }

    .nav-pill.active {
      background: var(--color-primary);
      color: white;
      box-shadow: var(--shadow-md);
    }

    .nav-pill:hover:not(.active) {
      background: var(--color-primary-light);
      color: var(--color-text-main);
    }

    .user-actions {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .icon-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: var(--color-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-sm);
      cursor: pointer;
      color: var(--color-text-main);
      transition: transform 0.2s;
    }

    .icon-btn:hover {
      transform: translateY(-2px);
    }

    .user-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      object-fit: cover;
      cursor: pointer;
      border: 2px solid white;
      box-shadow: var(--shadow-sm);
    }

    .app-container {
      display: grid;
      grid-template-rows: auto 1fr;
      max-width: 1600px;
      margin: 0 auto;
      width: 100%;
    }

    .logo-text {
      font-family: var(--font-heading);
      font-size: 24px;
      font-weight: 700;
      color: var(--color-text-main);
      letter-spacing: -0.02em;
    }

    /* Main Content */
    .main-content {
      padding: 24px 32px;
      overflow-y: scroll;
      background-color: var(--color-bg);
    }

    .top-bar {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      margin-bottom: 32px;
      font-size: 18px;
      color: var(--color-text-muted);
      font-weight: 400;
    }

    .welcome-text h1 {
      font-family: var(--font-heading);
      font-size: 32px;
      font-weight: 700;
      color: var(--color-text-main);
      margin-bottom: 8px;
      letter-spacing: -0.02em;
    }

    .welcome-text p {
      color: var(--color-text-muted);
      font-size: 16px;
    }

    .section {
      display: none;
      animation: fadeIn 0.4s ease-out;
    }

    .section.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Welcome Banner */
    .welcome-banner {
      background: linear-gradient(135deg, #e0e7ff 0%, #f3e8ff 100%);
      border-radius: var(--radius-lg);
      padding: 32px;
      margin-bottom: 24px;
      position: relative;
      overflow: hidden;
    }

    .welcome-content h1 {
      font-size: 28px;
      font-weight: 700;
      color: #111827;
      margin-bottom: 8px;
    }

    .welcome-content p {
      color: #4b5563;
      font-size: 16px;
    }

    .sparkle-icon {
      position: absolute;
      right: 40px;
      top: 50%;
      transform: translateY(-50%);
      color: #818cf8;
      opacity: 0.8;
      width: 48px;
      height: 48px;
    }

    /* Quick Actions Grid */
    .section-title {
      font-family: var(--font-heading);
      font-size: 20px;
      font-weight: 700;
      color: var(--color-text-main);
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .quick-actions {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
      margin-bottom: 32px;
    }

    .action-card {
      background: var(--color-card-bg);
      padding: 24px;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid transparent;
      transition: all 0.2s;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .action-card:hover {
      box-shadow: var(--shadow-md);
      border-color: var(--color-primary-light);
      transform: translateY(-2px);
    }

    .action-icon-box {
      width: 48px;
      height: 48px;
      background-color: var(--color-primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      margin-bottom: 20px;
    }

    .action-card-premium:hover .action-icon-premium {
      transform: scale(1.1);
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      }

      50% {
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.25);
      }
    }

    .action-card h3 {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--color-text-main);
    }

    .action-card p {
      color: var(--color-text-muted);
      font-size: 14px;
      margin-bottom: 24px;
      flex: 1;
      line-height: 1.5;
    }

    .action-link {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-weight: 500;
      color: var(--color-text-main);
      font-size: 14px;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 24px;
    }

    .stat-box {
      background: var(--color-card-bg);
      padding: 20px;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .stat-icon-small {
      width: 40px;
      height: 40px;
      background-color: #f3f4f6;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-text-muted);
    }

    .stat-info h4 {
      font-size: 20px;
      font-weight: 700;
      color: var(--color-text-main);
      margin-bottom: 2px;
    }

    .stat-info span {
      font-size: 12px;
      color: var(--color-text-muted);
    }

    /* Forms & Other Pages */
    .page-header {
      margin-bottom: 32px;
    }

    .page-header h1 {
      font-size: 24px;
      font-weight: 700;
      color: var(--color-text-main);
    }

    .card {
      background: var(--color-card-bg);
      border-radius: var(--radius-lg);
      padding: 32px;
      box-shadow: var(--shadow-sm);
      margin-bottom: 24px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--color-text-main);
      font-size: 14px;
    }

    .form-input,
    .form-select {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      font-family: var(--font-main);
      font-size: 14px;
      color: var(--color-text-main);
      background: #f9fafb;
      transition: border-color 0.2s;
    }

    .form-input:focus,
    .form-select:focus {
      border-color: var(--color-primary);
      background: white;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 12px 24px;
      background-color: var(--color-primary);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 500;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    }

    .btn:hover {
      background-color: var(--color-primary-hover);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
      color: white;
      padding: 12px 24px;
      border-radius: var(--radius-md);
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-size: 14px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
    }

    .btn-outline {
      background-color: transparent;
      border: 1px solid var(--color-border);
      color: var(--color-text-main);
    }

    .btn-outline:hover {
      background-color: #f9fafb;
    }

    /* Tag Input */
    .tag-input-container {
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      padding: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      min-height: 48px;
      background: #f9fafb;
      position: relative;
    }

    .tag-input-container:focus-within {
      border-color: var(--color-primary);
      background: white;
    }

    .tag {
      background-color: var(--color-primary-light);
      color: var(--color-primary);
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .tag-remove {
      cursor: pointer;
      opacity: 0.6;
    }

    .tag-remove:hover {
      opacity: 1;
    }

    .tag-input-field {
      border: none;
      flex: 1;
      min-width: 120px;
      padding: 4px;
      font-size: 14px;
      background: transparent;
    }

    .suggestions-list {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      margin-top: 4px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 10;
      display: none;
      box-shadow: var(--shadow-md);
    }

    .suggestion-item {
      padding: 10px 16px;
      cursor: pointer;
      font-size: 14px;
    }

    .suggestion-item:hover {
      background-color: #f3f4f6;
    }

    /* Lists */
    .list-header,
    .list-item {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr;
      padding: 16px 24px;
      align-items: center;
    }

    .list-header {
      background-color: #f9fafb;
      border-bottom: 1px solid var(--color-border);
      font-weight: 600;
      color: var(--color-text-muted);
      font-size: 13px;
      border-top-left-radius: var(--radius-lg);
      border-top-right-radius: var(--radius-lg);
    }

    .list-item {
      border-bottom: 1px solid var(--color-border);
      color: var(--color-text-main);
    }

    .list-item:last-child {
      border-bottom: none;
    }

    /* Chart */
    .chart-wrapper {
      height: 300px;
      width: 100%;
    }

    /* Premium Dashboard Layout */
    .dashboard-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }

    .dashboard-row-3 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
    }

    /* Welcome Banner */
    .welcome-banner {
      background: linear-gradient(135deg, var(--color-primary) 0%, #059669 100%);
      border-radius: 24px;
      padding: 40px;
      color: white;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: center;
      min-height: 300px;
      box-shadow: 0 20px 40px rgba(16, 185, 129, 0.3);
    }

    .welcome-banner::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -20%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 60%);
      transform: rotate(30deg);
      pointer-events: none;
      animation: floatBanner 8s ease-in-out infinite;
    }

    @keyframes floatBanner {

      0%,
      100% {
        transform: rotate(30deg) translateY(0);
      }

      50% {
        transform: rotate(30deg) translateY(-20px);
      }
    }

    .welcome-title {
      font-family: var(--font-heading);
      font-size: 48px;
      font-weight: 700;
      margin-bottom: 16px;
      line-height: 1.1;
      position: relative;
      z-index: 1;
      letter-spacing: -0.03em;
    }

    .welcome-subtitle {
      font-family: var(--font-main);
      font-size: 18px;
      opacity: 0.9;
      margin-bottom: 32px;
      max-width: 80%;
      line-height: 1.5;
      position: relative;
      z-index: 1;
    }

    .banner-actions {
      display: flex;
      gap: 16px;
      position: relative;
      z-index: 1;
    }

    .btn-banner {
      background: white;
      color: var(--color-primary);
      border: none;
      padding: 12px 24px;
      border-radius: 50px;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .btn-banner:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .btn-banner-outline {
      background: rgba(255, 255, 255, 0.15);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 12px 24px;
      border-radius: 50px;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .btn-banner-outline:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: translateY(-2px);
    }

    /* Stats Column */
    .stats-column {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .stat-card-premium {
      background: white;
      border-radius: 24px;
      padding: 24px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03);
      border: 1px solid rgba(0, 0, 0, 0.03);
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: transform 0.3s ease;
    }

    .stat-card-premium:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.06);
    }

    .stat-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }

    .stat-title {
      font-size: 14px;
      color: #6b7280;
      font-weight: 500;
    }

    .stat-icon-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
    }

    .stat-number {
      font-size: 48px;
      font-weight: 700;
      color: #111827;
      line-height: 1;
      margin-bottom: 8px;
    }

    .stat-trend {
      font-size: 13px;
      color: #10b981;
      display: flex;
      align-items: center;
      gap: 4px;
      font-weight: 500;
    }

    /* Donut Chart Simulation */
    .donut-chart {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: conic-gradient(var(--color-primary) 0% 0%, #e5e7eb 0% 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .donut-inner {
      width: 64px;
      height: 64px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 16px;
      color: #111827;
    }

    /* Action Cards Bottom Row */
    .action-card-premium {
      background: white;
      border-radius: 24px;
      padding: 32px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03);
      border: 1px solid rgba(0, 0, 0, 0.03);
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      height: 100%;
    }

    .action-card-premium:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
    }

    .action-icon-premium {
      width: 56px;
      height: 56px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      margin-bottom: 24px;
      transition: all 0.3s ease;
    }

    .action-title-premium {
      font-size: 20px;
      font-weight: 700;
      color: #111827;
      margin-bottom: 8px;
    }

    .action-desc-premium {
      font-size: 14px;
      color: #6b7280;
      line-height: 1.5;
      margin-bottom: 24px;
      flex: 1;
    }

    .action-link-premium {
      font-size: 15px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    @media (max-width: 1024px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }

      .dashboard-row-3 {
        grid-template-columns: 1fr;
      }
    }

    /* New Home Styles */
    .home-hero {
      display: flex;
      align-items: center;
      gap: 3rem;
      padding: 2rem 0;
    }

    .hero-content {
      flex: 1;
    }

    .hero-visual {
      flex: 1;
      height: 400px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .hero-subtitle {
      font-size: 1.1rem;
      color: var(--color-text-muted);
      margin-bottom: 2rem;
      line-height: 1.6;
      max-width: 500px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.5rem;
      margin-bottom: 2.5rem;
    }

    .stat-card {
      background: white;
      padding: 1.25rem;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--color-border);
      display: flex;
      align-items: center;
      gap: 1rem;
      transition: transform 0.2s;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .stat-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--color-text-main);
      line-height: 1;
    }

    .stat-label {
      font-size: 0.875rem;
      color: var(--color-text-muted);
      margin-top: 4px;
    }

    .quick-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }

    .action-card {
      background: white;
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      text-align: left;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 1rem;
      width: 100%;
    }

    .action-card:hover {
      border-color: var(--color-primary);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.1);
    }

    .action-icon {
      font-size: 1.5rem;
    }

    .action-text h3 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .action-text p {
      font-size: 0.875rem;
      color: var(--color-text-muted);
    }

    .action-arrow {
      margin-left: auto;
      color: var(--color-primary);
      font-weight: 600;
    }

    /* Roadmap Styles */
    .roadmap-container {
      position: relative;
      padding: 20px 0;
    }

    .roadmap-step {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      position: relative;
    }

    .roadmap-step:last-child {
      margin-bottom: 0;
    }

    .roadmap-step::before {
      content: '';
      position: absolute;
      left: 15px;
      top: 30px;
      bottom: -30px;
      width: 2px;
      background: #e5e7eb;
    }

    .roadmap-step:last-child::before {
      display: none;
    }

    .step-number {
      width: 32px;
      height: 32px;
      background: var(--color-primary);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
      flex-shrink: 0;
      z-index: 1;
      box-shadow: 0 0 0 4px var(--color-primary-light);
    }

    .step-content {
      background: #f9fafb;
      padding: 15px;
      border-radius: 12px;
      flex: 1;
      border: 1px solid #f3f4f6;
    }

    .step-title {
      font-weight: 600;
      color: var(--color-text-main);
      margin-bottom: 4px;
    }

    .step-desc {
      font-size: 14px;
      color: var(--color-text-muted);
    }

    /* Animations */
    .float-1 {
      animation: float1 6s ease-in-out infinite;
    }

    .float-2 {
      animation: float2 7s ease-in-out infinite;
    }

    @keyframes float1 {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-10px);
      }
    }

    @keyframes float2 {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-15px);
      }
    }

    /* Toast Notifications */
    .toast-container {
      position: fixed;
      top: 80px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 12px;
      pointer-events: none;
      max-width: 400px;
    }

    .toast {
      background: white;
      padding: 16px 20px;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 300px;
      max-width: 400px;
      pointer-events: all;
      animation: slideInRight 0.3s ease-out;
      border-left: 4px solid;
      word-wrap: break-word;
    }

    .toast.success {
      border-left-color: #10b981;
    }

    .toast.error {
      border-left-color: #ef4444;
    }

    .toast.info {
      border-left-color: #3b82f6;
    }

    .toast.warning {
      border-left-color: #f59e0b;
    }

    .toast-icon {
      font-size: 24px;
      flex-shrink: 0;
    }

    .toast-content {
      flex: 1;
      min-width: 0;
    }

    .toast-title {
      font-weight: 600;
      font-size: 14px;
      color: #111827;
      margin-bottom: 2px;
    }

    .toast-message {
      font-size: 13px;
      color: #6b7280;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .toast-close {
      background: none;
      border: none;
      font-size: 20px;
      color: #9ca3af;
      cursor: pointer;
      padding: 0;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: all 0.2s;
      flex-shrink: 0;
    }

    .toast-close:hover {
      background: #f3f4f6;
      color: #111827;
    }

    @keyframes slideInRight {
      from {
        transform: translateX(400px);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOutRight {
      from {
        transform: translateX(0);
        opacity: 1;
      }

      to {
        transform: translateX(400px);
        opacity: 0;
      }
    }

    /* Loading Spinner */
    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 0.6s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Profile Completion Bar */
    .profile-completion {
      background: #f3f4f6;
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
      margin: 12px 0;
    }

    .profile-completion-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--color-primary) 0%, #10b981 100%);
      transition: width 0.5s ease;
      border-radius: 4px;
    }

    /* Form Validation */
    .form-input.valid {
      border-color: #10b981;
      background: #f0fdf4;
    }

    .form-input.invalid {
      border-color: #ef4444;
      background: #fef2f2;
    }

    .form-error {
      color: #ef4444;
      font-size: 12px;
      margin-top: 4px;
      display: none;
    }

    .form-error.show {
      display: block;
    }

    /* Mobile Menu */
    .mobile-menu-toggle {
      display: none;
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
      z-index: 1001;
      position: relative;
    }

    @media (max-width: 768px) {
      .mobile-menu-toggle {
        display: block;
      }

      .nav-pills {
        position: fixed;
        top: 70px;
        left: 0;
        right: 0;
        background: white;
        flex-direction: column;
        padding: 16px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transform: translateY(-100%);
        transition: transform 0.3s ease;
        z-index: 1000;
        max-height: calc(100vh - 70px);
        overflow-y: auto;
      }

      .nav-pills.show {
        transform: translateY(0);
      }

      .nav-pill {
        width: 100%;
        text-align: center;
        padding: 12px 16px;
      }

      .toast-container {
        top: 90px;
        right: 10px;
        left: 10px;
        max-width: none;
      }

      .toast {
        min-width: auto;
        max-width: none;
      }
    }

    /* Modal z-index fix */
    #resume-preview-modal {
      z-index: 10000;
    }

    /* Ensure top nav stays on top */
    .top-nav {
      z-index: 999;
      position: relative;
    }

    /* Main content should be below nav */
    .main-content {
      position: relative;
      z-index: 1;
    }

    .resume-version-item {
      transition: all 0.2s;
    }

    .resume-version-item:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    /* Security: Hide content until authenticated */
    body {
      visibility: hidden;
    }

    body.authenticated {
      visibility: visible;
    }

    /* Loading screen */
    #auth-loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      visibility: visible;
    }

    #auth-loading.hidden {
      display: none;
    }

    .auth-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
  </style>
</head>

<body>
  <!-- Authentication Loading Screen -->
  <div id="auth-loading">
    <div class="auth-spinner"></div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toast-container"></div>

  <div class="app-container">
    <header class="top-nav">
      <div class="logo-text" style="font-size: 28px; font-family: 'Space Grotesk', sans-serif; font-weight: 700;">
        Edu2Job</div>

      <!-- Mobile Menu Toggle -->
      <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle menu">
        <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>

      <nav class="nav-pills">
        <a href="#home" class="nav-pill active" data-section="home" id="nav-home">Dashboard</a>
        <a href="#profile" class="nav-pill" data-section="profile" id="nav-profile">Profile</a>
        <a href="#predict" class="nav-pill" data-section="predict" id="nav-predict">Predict</a>
        <a href="#history" class="nav-pill" data-section="history" id="nav-history">History</a>
        <a href="#resume" class="nav-pill" data-section="resume" id="nav-resume">Resume Builder</a>
      </nav>
      <div class="user-actions">
        <div class="icon-btn" id="logout-btn" title="Logout">
          <svg class="icon" viewBox="0 0 24 24">
            <path d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg>
        </div>
        <img src="https://ui-avatars.com/api/?name=User&background=random" class="user-avatar" id="header-avatar">
      </div>
    </header>

    <main class="main-content">
      <div class="top-bar">
        Hi <span id="user-name-display" style="color: var(--color-text-main); font-weight: 600;">User</span>, let's
        shape your career today!
      </div>

      <!-- HOME SECTION -->
      <section id="home" class="section active">
        <!-- Top Grid: Banner + Stats -->
        <div class="dashboard-grid">
          <!-- Welcome Banner -->
          <div class="welcome-banner">
            <div class="welcome-title" id="welcome-msg">Welcome back, test üëã</div>
            <div class="welcome-subtitle">Your journey from education to dream career starts here. Let's discover what's
              next.</div>
            <div class="banner-actions">
              <button class="btn-banner" id="banner-predict-btn">
                <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
                Start Prediction
              </button>
              <button class="btn-banner-outline" id="banner-profile-btn">Complete Profile</button>
            </div>
          </div>

          <!-- Stats Column -->
          <div class="stats-column">
            <!-- Predictions Made Card -->
            <div class="stat-card-premium">
              <div class="stat-header">
                <div class="stat-title">Predictions Made</div>
                <div class="stat-icon-circle" style="background: var(--color-primary);">
                  <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10" />
                    <path d="M12 6v6l4 2" />
                  </svg>
                </div>
              </div>
              <div class="stat-number" id="stat-total">0</div>
              <div class="stat-trend">
                <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                </svg>
                Ready to start
              </div>
            </div>

            <!-- Profile Completion Card -->
            <div class="stat-card-premium">
              <div class="stat-header">
                <div class="stat-title">Profile</div>
                <div class="donut-chart" id="donut-chart">
                  <div class="donut-inner" id="stat-completion">0%</div>
                </div>
              </div>
              <div style="font-size: 18px; font-weight: 600; color: #111827; margin-top: 8px;">Completion</div>
              <div class="stat-trend" style="color: var(--color-primary);">
                Complete now ‚Üí
              </div>
            </div>
          </div>
        </div>

        <!-- Bottom Row: 3 Action Cards -->
        <div class="dashboard-row-3">
          <!-- Predict Your Career -->
          <div class="action-card-premium" data-nav="predict">
            <div class="action-icon-premium"
              style="background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);">
              <svg width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10" />
                <circle cx="12" cy="12" r="6" />
                <circle cx="12" cy="12" r="2" />
              </svg>
            </div>
            <div class="action-title-premium">Predict Your Career</div>
            <div class="action-desc-premium">Get AI-powered job recommendations based on your unique profile</div>
            <div class="action-link-premium" style="color: var(--color-primary);">
              Start now
              <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14M12 5l7 7-7 7" />
              </svg>
            </div>
          </div>

          <!-- View History -->
          <div class="action-card-premium" data-nav="history">
            <div class="action-icon-premium" style="background: linear-gradient(135deg, #ec4899 0%, #f43f5e 100%);">
              <svg width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10" />
                <path d="M12 6v6l4 2" />
              </svg>
            </div>
            <div class="action-title-premium">View History</div>
            <div class="action-desc-premium">Track all your previous predictions and career insights</div>
            <div class="action-link-premium" style="color: #ec4899;">
              Explore
              <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14M12 5l7 7-7 7" />
              </svg>
            </div>
          </div>

          <!-- Your Profile -->
          <div class="action-card-premium" data-nav="profile">
            <div class="action-icon-premium"
              style="background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);">
              <svg width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                <circle cx="12" cy="7" r="4" />
              </svg>
            </div>
            <div class="action-title-premium">Your Profile</div>
            <div class="action-desc-premium">Update your details for better, personalized predictions</div>
            <div class="action-link-premium" style="color: var(--color-primary);">
              Update
              <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14M12 5l7 7-7 7" />
              </svg>
            </div>
          </div>
        </div>

        <!-- Career Tips Card -->
        <div class="card"
          style="border: none; box-shadow: var(--shadow-md); background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%); border-left: 4px solid var(--color-primary); margin-top: 24px;">
          <div style="display: flex; align-items: flex-start; gap: 20px;">
            <div
              style="width: 56px; height: 56px; background: var(--color-primary); border-radius: 16px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
              <svg width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="white" stroke-width="2">
                <path
                  d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
              </svg>
            </div>
            <div style="flex: 1;">
              <h3
                style="font-size: 20px; font-weight: 700; color: #111827; margin-bottom: 8px; font-family: var(--font-heading);">
                üí° Career Tip of the Day</h3>
              <p style="color: #374151; line-height: 1.6; margin-bottom: 12px;">Keep your skills updated! The tech
                industry evolves rapidly. Dedicate at least 30 minutes daily to learning new technologies or improving
                existing skills.</p>
              <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                <span
                  style="background: white; color: var(--color-primary); padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; border: 1px solid var(--color-primary);">üéØ
                  Skill Building</span>
                <span
                  style="background: white; color: var(--color-primary); padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; border: 1px solid var(--color-primary);">üìö
                  Continuous Learning</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- PROFILE SECTION -->
      <section id="profile" class="section">
        <!-- Profile Header Card -->
        <div class="card"
          style="padding: 0; overflow: hidden; margin-bottom: 24px; border: none; box-shadow: var(--shadow-md);">
          <div
            style="height: 180px; background: linear-gradient(135deg, #059669 0%, #10b981 100%); position: relative;">
            <div
              style="position: absolute; inset: 0; background-image: radial-gradient(circle at 20% 50%, rgba(255,255,255,0.1) 0%, transparent 50%);">
            </div>
          </div>
          <div style="padding: 0 40px 40px; position: relative;">
            <div
              style="display: flex; justify-content: space-between; align-items: flex-end; margin-top: -80px; margin-bottom: 24px;">
              <div style="position: relative;">
                <img src="https://ui-avatars.com/api/?name=User&background=random" id="profile-avatar-lg"
                  style="width: 160px; height: 160px; border-radius: 50%; border: 6px solid white; box-shadow: 0 4px 12px rgba(0,0,0,0.1); object-fit: cover; background: white;">
              </div>
              <div style="display: flex; gap: 12px; margin-bottom: 10px;">
                <button class="btn btn-primary" style="border-radius: 50px; padding: 10px 32px;"
                  id="save-profile-btn">Save Changes</button>
              </div>
            </div>

            <div style="margin-bottom: 32px;">
              <h1
                style="font-size: 32px; font-weight: 700; color: var(--color-text-main); margin-bottom: 4px; font-family: var(--font-heading);"
                id="profile-name-display">User Name</h1>
              <p style="font-size: 18px; color: var(--color-text-muted); margin-bottom: 12px;">Student / Professional
              </p>

              <!-- Profile Completion -->
              <div style="margin-top: 16px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                  <span style="font-size: 13px; font-weight: 600; color: #374151;">Profile Completion</span>
                  <span id="profile-completion-percent"
                    style="font-size: 13px; font-weight: 700; color: var(--color-primary);">0%</span>
                </div>
                <div class="profile-completion">
                  <div class="profile-completion-fill" id="profile-completion-bar" style="width: 0%;"></div>
                </div>
              </div>
              <div style="display: flex; gap: 24px; color: var(--color-text-muted); font-size: 14px;">
                <span style="display: flex; align-items: center; gap: 6px;"><svg width="16" height="16" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                    <path d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                  </svg> Location</span>
                <span style="display: flex; align-items: center; gap: 6px;"><svg width="16" height="16" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path
                      d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                  </svg> Contact Info</span>
              </div>
            </div>

            <form id="profile-form" style="max-width: 900px; margin: 0 auto;">
              <!-- Personal Information -->
              <div class="card" style="box-shadow: none; border: 1px solid var(--color-border); margin-bottom: 24px;">
                <div class="section-title">üìã Personal Information</div>
                <div class="form-group">
                  <label class="form-label">Full Name</label>
                  <input type="text" class="form-input" id="p-name" placeholder="John Doe">
                </div>
                <div class="form-group">
                  <label class="form-label">Email</label>
                  <input type="email" class="form-input" id="p-email" placeholder="john@example.com">
                </div>
                <div class="form-group">
                  <label class="form-label">About / Professional Summary</label>
                  <textarea class="form-input" id="p-summary" rows="4"
                    placeholder="Write a brief professional summary about yourself..."></textarea>
                </div>
              </div>

              <!-- Education -->
              <div class="card" style="box-shadow: none; border: 1px solid var(--color-border); margin-bottom: 24px;">
                <div class="section-title">üéì Education</div>
                <div class="form-group">
                  <label class="form-label">Degree</label>
                  <select class="form-select" id="p-degree">
                    <option value="">Select Degree</option>
                    <option value="Bachelors">Bachelor's</option>
                    <option value="Masters">Master's</option>
                    <option value="PhD">PhD</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Major / Field of Study</label>
                  <select class="form-select" id="p-major">
                    <option value="">Select Major</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Specialization</label>
                  <select class="form-select" id="p-specialization">
                    <option value="">Select Specialization</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">CGPA / GPA (out of 10 or 4)</label>
                  <input type="number" step="0.01" class="form-input" id="p-cgpa" placeholder="3.8">
                </div>
              </div>

              <!-- Skills & Experience -->
              <div class="card" style="box-shadow: none; border: 1px solid var(--color-border); margin-bottom: 24px;">
                <div class="section-title">üíº Skills & Experience</div>
                <div class="form-group">
                  <label class="form-label">Years of Experience</label>
                  <input type="number" class="form-input" id="p-experience" placeholder="0">
                </div>
                <div class="form-group">
                  <label class="form-label">Skills</label>
                  <div id="p-skills-container" class="tag-input-container">
                    <input type="text" class="tag-input-field" placeholder="Add skill...">
                    <div class="suggestions-list"></div>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">Certifications</label>
                  <div id="p-certs-container" class="tag-input-container">
                    <input type="text" class="tag-input-field" placeholder="Add certification...">
                    <div class="suggestions-list"></div>
                  </div>
                </div>
              </div>

              <!-- Social Links -->
              <div class="card" style="box-shadow: none; border: 1px solid var(--color-border); margin-bottom: 24px;">
                <div class="section-title">üîó Social Links</div>
                <div class="form-group">
                  <label class="form-label">LinkedIn Profile</label>
                  <input type="url" class="form-input" id="p-linkedin"
                    placeholder="https://linkedin.com/in/yourprofile">
                </div>
                <div class="form-group">
                  <label class="form-label">GitHub Profile</label>
                  <input type="url" class="form-input" id="p-github" placeholder="https://github.com/yourusername">
                </div>
                <div class="form-group">
                  <label class="form-label">Portfolio Website</label>
                  <input type="url" class="form-input" id="p-portfolio" placeholder="https://yourportfolio.com">
                </div>
              </div>

              <!-- Languages -->
              <div class="card" style="box-shadow: none; border: 1px solid var(--color-border); margin-bottom: 24px;">
                <div class="section-title">üåç Languages</div>
                <div id="languages-list" style="display: flex; flex-direction: column; gap: 12px;">
                  <!-- Languages will be added dynamically -->
                </div>
                <button type="button" id="add-language-btn" class="btn btn-outline"
                  style="width: 100%; margin-top: 12px;">
                  + Add Language
                </button>
              </div>

              <!-- NEW: Projects Section (Full Width) -->
              <div class="card" style="box-shadow: none; border: 1px solid var(--color-border); margin-top: 24px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                  <div class="section-title" style="margin: 0;">üíº Projects</div>
                  <button type="button" id="add-project-btn" class="btn btn-outline"
                    style="padding: 8px 16px; font-size: 13px;">
                    + Add Project
                  </button>
                </div>
                <div id="projects-list" style="display: flex; flex-direction: column; gap: 16px;">
                  <!-- Projects will be added dynamically -->
                  <div
                    style="text-align: center; padding: 40px; color: #9ca3af; border: 2px dashed #e5e7eb; border-radius: 12px;">
                    <div style="font-size: 32px; margin-bottom: 8px;">üìÅ</div>
                    <div style="font-size: 14px;">No projects added yet. Click "Add Project" to showcase your work.
                    </div>
                  </div>
                </div>
              </div>

              <!-- NEW: Achievements Section (Full Width) -->
              <div class="card" style="box-shadow: none; border: 1px solid var(--color-border); margin-top: 24px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                  <div class="section-title" style="margin: 0;">üèÜ Achievements & Awards</div>
                  <button type="button" id="add-achievement-btn" class="btn btn-outline"
                    style="padding: 8px 16px; font-size: 13px;">
                    + Add Achievement
                  </button>
                </div>
                <div id="achievements-list" style="display: flex; flex-direction: column; gap: 12px;">
                  <!-- Achievements will be added dynamically -->
                </div>
              </div>

              <button type="submit" id="profile-form-submit" style="display: none;">Save</button>
            </form>
          </div>
        </div>
      </section>

      <!-- PREDICT SECTION -->
      <section id="predict" class="section">
        <div class="page-header">
          <h1>Career Prediction</h1>
          <p style="color: var(--color-text-muted);">Enter your details to get AI-powered career insights.</p>
        </div>


        <div class="card" style="border: none; box-shadow: var(--shadow-md); padding: 40px;">
          <form id="predict-form">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Degree</label>
                <select class="form-select" id="pr-degree" required>
                  <option value="">Select Degree</option>
                  <option value="Bachelors">Bachelor's</option>
                  <option value="Masters">Master's</option>
                  <option value="PhD">PhD</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Major</label>
                <select class="form-select" id="pr-major" required>
                  <option value="">Select Major</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Specialization <span style="color: #ef4444;">*</span></label>
                <select class="form-select" id="pr-specialization" required>
                  <option value="">Select Specialization</option>
                </select>
              </div>
            </div>

            <div class="form-grid" style="grid-template-columns: 1fr 1fr 1fr;">
              <div class="form-group">
                <label class="form-label">CGPA</label>
                <input type="number" step="0.01" class="form-input" id="pr-cgpa" required placeholder="3.5">
              </div>
              <div class="form-group">
                <label class="form-label">Experience (Yrs)</label>
                <input type="number" class="form-input" id="pr-experience" required placeholder="2">
              </div>
              <div class="form-group">
                <label class="form-label">Preferred Industry</label>
                <select class="form-select" id="pr-industry">
                  <option value="Tech">Technology</option>
                  <option value="Finance">Finance</option>
                  <option value="Health">Healthcare</option>
                  <option value="Education">Education</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Skills</label>
              <div id="pr-skills-container" class="tag-input-container">
                <input type="text" class="tag-input-field" placeholder="Add skills...">
                <div class="suggestions-list"></div>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Certifications</label>
              <div id="pr-certs-container" class="tag-input-container">
                <input type="text" class="tag-input-field" placeholder="Add certifications...">
                <div class="suggestions-list"></div>
              </div>
            </div>

            <div style="text-align: right;">
              <button type="submit" class="btn">Generate Prediction</button>
            </div>
          </form>
        </div>

        <div id="prediction-output" style="display: none;">
          <!-- Enhanced Results Header with Confidence Gauge -->
          <div class="card"
            style="border: 2px solid var(--color-primary-light); background: linear-gradient(135deg, #fdfcff 0%, #f8f9ff 100%); position: relative; overflow: hidden;">
            <div
              style="position: absolute; top: -50px; right: -50px; width: 200px; height: 200px; background: radial-gradient(circle, rgba(16, 185, 129, 0.1) 0%, transparent 70%); border-radius: 50%;">
            </div>

            <div
              style="display: grid; grid-template-columns: auto 1fr; gap: 40px; align-items: center; position: relative; z-index: 1;">
              <!-- Circular Confidence Gauge -->
              <div style="text-align: center;">
                <div style="position: relative; width: 180px; height: 180px; margin: 0 auto;">
                  <svg id="confidence-gauge" width="180" height="180" style="transform: rotate(-90deg);">
                    <circle cx="90" cy="90" r="75" fill="none" stroke="#e5e7eb" stroke-width="12"></circle>
                    <circle id="confidence-progress" cx="90" cy="90" r="75" fill="none" stroke="url(#gaugeGradient)"
                      stroke-width="12" stroke-dasharray="471" stroke-dashoffset="471" stroke-linecap="round"
                      style="transition: stroke-dashoffset 1.5s cubic-bezier(0.4, 0, 0.2, 1);"></circle>
                    <defs>
                      <linearGradient id="gaugeGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:var(--color-primary);stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
                      </linearGradient>
                    </defs>
                  </svg>
                  <div
                    style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                    <div id="res-confidence"
                      style="font-size: 36px; font-weight: 800; color: var(--color-primary); line-height: 1;">
                      92%</div>
                    <div
                      style="font-size: 11px; color: #6b7280; text-transform: uppercase; letter-spacing: 1px; margin-top: 4px;">
                      Confidence</div>
                  </div>
                </div>
                <div id="confidence-label"
                  style="margin-top: 12px; font-size: 13px; font-weight: 600; padding: 6px 16px; border-radius: 20px; display: inline-block;">
                  Highly Confident Match
                </div>
              </div>

              <!-- Role Info -->
              <div>
                <div
                  style="font-size: 13px; color: #6b7280; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">
                  üéØ Predicted Career Role</div>
                <h2 id="res-role"
                  style="font-size: 32px; font-weight: 800; color: #111827; margin-bottom: 16px; line-height: 1.2;">
                  Software Engineer</h2>
                <p id="res-description" style="color: #6b7280; font-size: 15px; line-height: 1.7; margin-bottom: 20px;">
                </p>

                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px;">
                  <div style="background: #f0fdf4; padding: 16px; border-radius: 12px; border: 1px solid #bbf7d0;">
                    <div style="font-size: 12px; color: #16a34a; font-weight: 600; margin-bottom: 4px;">üí∞ SALARY RANGE
                    </div>
                    <div id="res-salary" style="font-size: 20px; font-weight: 700; color: #15803d;">‚Çπ8L - ‚Çπ15L</div>
                  </div>
                  <div style="background: #eff6ff; padding: 16px; border-radius: 12px; border: 1px solid #bfdbfe;">
                    <div style="font-size: 12px; color: #2563eb; font-weight: 600; margin-bottom: 4px;">üìà MARKET GROWTH
                    </div>
                    <div id="res-growth" style="font-size: 20px; font-weight: 700; color: #1d4ed8;">High</div>
                  </div>
                  <div style="background: #fef3c7; padding: 16px; border-radius: 12px; border: 1px solid #fde68a;">
                    <div style="font-size: 12px; color: #d97706; font-weight: 600; margin-bottom: 4px;">üî• DEMAND</div>
                    <div id="res-demand" style="font-size: 20px; font-weight: 700; color: #b45309;">Very High</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Career Progression Timeline -->
          <div class="card">
            <h3 class="section-title" style="margin-bottom: 24px;">
              <span style="font-size: 24px; font-weight: 700;">üöÄ Career Progression Timeline</span>
            </h3>
            <div id="career-timeline" style="position: relative; padding: 20px 0;">
              <!-- Timeline will be populated by JS -->
            </div>
          </div>

          <!-- Enhanced Skill Analysis Grid -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
            <!-- Multi-Layer Skill Radar -->
            <div class="card">
              <h3 class="section-title" style="margin-bottom: 20px;">
                <span style="font-size: 18px; font-weight: 700;">üéØ Skill Match Analysis</span>
              </h3>
              <div style="height: 320px; position: relative;">
                <canvas id="skillChart"></canvas>
              </div>
              <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px; color: #374151;">Skills to Develop
                </h4>
                <div id="res-missing-skills" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
              </div>
            </div>

            <!-- Market Demand & Confidence -->
            <div class="card">
              <h3 class="section-title" style="margin-bottom: 20px;">
                <span style="font-size: 18px; font-weight: 700;">üìä Market Position</span>
              </h3>
              <div style="height: 320px;">
                <canvas id="confidenceChart"></canvas>
              </div>
              <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px; color: #374151;">Recommended
                  Certifications</h4>
                <ul id="res-certs" style="font-size: 13px; color: #6b7280; padding-left: 20px; line-height: 1.8;"></ul>
              </div>
            </div>
          </div>

          <!-- Learning Resources -->
          <div class="card"
            style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: none; margin-bottom: 24px;">
            <h3
              style="font-size: 18px; font-weight: 700; color: #78350f; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
              üìö Recommended Learning Resources
            </h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
              <div style="background: white; padding: 16px; border-radius: 12px; border: 1px solid #fbbf24;">
                <div style="font-size: 12px; font-weight: 600; color: #92400e; margin-bottom: 8px;">COURSE</div>
                <div style="font-weight: 600; color: #111827; margin-bottom: 4px;">Machine Learning A-Z</div>
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 8px;">Udemy ‚Ä¢ 44 hours</div>
                <div style="display: flex; align-items: center; gap: 4px;">
                  <span style="color: #f59e0b;">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                  <span style="font-size: 12px; color: #6b7280;">4.8</span>
                </div>
              </div>
              <div style="background: white; padding: 16px; border-radius: 12px; border: 1px solid #fbbf24;">
                <div style="font-size: 12px; font-weight: 600; color: #92400e; margin-bottom: 8px;">CERTIFICATION</div>
                <div style="font-weight: 600; color: #111827; margin-bottom: 4px;">AWS Cloud Practitioner</div>
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 8px;">Amazon ‚Ä¢ 3 months</div>
                <div style="display: flex; align-items: center; gap: 4px;">
                  <span
                    style="background: #dcfce7; color: #166534; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 600;">Industry
                    Recognized</span>
                </div>
              </div>
              <div style="background: white; padding: 16px; border-radius: 12px; border: 1px solid #fbbf24;">
                <div style="font-size: 12px; font-weight: 600; color: #92400e; margin-bottom: 8px;">BOOTCAMP</div>
                <div style="font-weight: 600; color: #111827; margin-bottom: 4px;">Data Science Intensive</div>
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 8px;">Coursera ‚Ä¢ 6 months</div>
                <div style="display: flex; align-items: center; gap: 4px;">
                  <span
                    style="background: #dbeafe; color: #1e40af; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 600;">Hands-on
                    Projects</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Day in the Life -->
          <div class="card"
            style="background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%); border: none; margin-bottom: 24px;">
            <h3
              style="font-size: 18px; font-weight: 700; color: #5b21b6; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
              üåÖ A Day in the Life
            </h3>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;">
              <div style="background: white; padding: 16px; border-radius: 12px; text-align: center;">
                <div style="font-size: 24px; margin-bottom: 8px;">‚òï</div>
                <div style="font-size: 11px; font-weight: 600; color: #7c3aed; margin-bottom: 4px;">9:00 AM</div>
                <div style="font-size: 13px; color: #111827; font-weight: 500;">Team Standup</div>
              </div>
              <div style="background: white; padding: 16px; border-radius: 12px; text-align: center;">
                <div style="font-size: 24px; margin-bottom: 8px;">üíª</div>
                <div style="font-size: 11px; font-weight: 600; color: #7c3aed; margin-bottom: 4px;">10:00 AM</div>
                <div style="font-size: 13px; color: #111827; font-weight: 500;">Model Development</div>
              </div>
              <div style="background: white; padding: 16px; border-radius: 12px; text-align: center;">
                <div style="font-size: 24px; margin-bottom: 8px;">üìä</div>
                <div style="font-size: 11px; font-weight: 600; color: #7c3aed; margin-bottom: 4px;">2:00 PM</div>
                <div style="font-size: 13px; color: #111827; font-weight: 500;">Data Analysis</div>
              </div>
              <div style="background: white; padding: 16px; border-radius: 12px; text-align: center;">
                <div style="font-size: 24px; margin-bottom: 8px;">üéØ</div>
                <div style="font-size: 11px; font-weight: 600; color: #7c3aed; margin-bottom: 4px;">4:00 PM</div>
                <div style="font-size: 13px; color: #111827; font-weight: 500;">Stakeholder Review</div>
              </div>
            </div>
          </div>

          <!-- Salary Negotiation & Market Trends -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
            <!-- Salary Negotiation -->
            <div class="card" style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border: none;">
              <h3
                style="font-size: 18px; font-weight: 700; color: #166534; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                üí∞ Salary Negotiation Tips
              </h3>
              <ul style="list-style: none; padding: 0; margin: 0; color: #14532d; font-size: 14px; line-height: 1.6;">
                <li style="margin-bottom: 12px; display: flex; gap: 8px;">
                  <span>‚úÖ</span> <span>Research market rates for <strong><span id="neg-role">this role</span></strong>
                    in your location.</span>
                </li>
                <li style="margin-bottom: 12px; display: flex; gap: 8px;">
                  <span>‚úÖ</span> <span>Highlight your unique skills: <strong id="neg-skill">your top
                      skill</strong>.</span>
                </li>
                <li style="margin-bottom: 12px; display: flex; gap: 8px;">
                  <span>‚úÖ</span> <span>Don't share your current salary first; ask for their budget.</span>
                </li>
                <li style="display: flex; gap: 8px;">
                  <span>‚úÖ</span> <span>Consider total compensation (equity, benefits, remote work).</span>
                </li>
              </ul>
              <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #a7f3d0;">
                <div style="font-size: 13px; font-weight: 600; color: #166534; margin-bottom: 8px;">üíº Salary by
                  Location</div>
                <select id="salary-location"
                  style="width: 100%; padding: 8px 12px; border: 1px solid #a7f3d0; border-radius: 8px; font-size: 13px; background: white; color: #111827; cursor: pointer;">
                  <option value="bangalore">Bangalore: ‚Çπ12-18 LPA</option>
                  <option value="mumbai">Mumbai: ‚Çπ14-20 LPA</option>
                  <option value="delhi">Delhi NCR: ‚Çπ13-19 LPA</option>
                  <option value="hyderabad">Hyderabad: ‚Çπ11-17 LPA</option>
                  <option value="pune">Pune: ‚Çπ10-16 LPA</option>
                  <option value="chennai">Chennai: ‚Çπ10-15 LPA</option>
                </select>
              </div>
            </div>

            <!-- Job Market Trends -->
            <div class="card" style="background: white; border: 1px solid #e5e7eb;">
              <h3
                style="font-size: 18px; font-weight: 700; color: #111827; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                üìà Job Market Trends
              </h3>
              <div
                style="height: 150px; display: flex; align-items: flex-end; justify-content: space-between; padding-bottom: 10px; border-bottom: 1px solid #e5e7eb;">
                <div
                  style="width: 15%; background: #e5e7eb; height: 40%; border-radius: 4px 4px 0 0; position: relative;">
                </div>
                <div style="width: 15%; background: #d1d5db; height: 55%; border-radius: 4px 4px 0 0;"></div>
                <div style="width: 15%; background: #9ca3af; height: 65%; border-radius: 4px 4px 0 0;"></div>
                <div style="width: 15%; background: #6b7280; height: 80%; border-radius: 4px 4px 0 0;"></div>
                <div
                  style="width: 15%; background: var(--color-primary); height: 95%; border-radius: 4px 4px 0 0; position: relative;">
                  <span
                    style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-size: 12px; font-weight: 700; color: var(--color-primary);">+24%</span>
                </div>
              </div>
              <div
                style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 12px; color: #6b7280;">
                <span>2021</span>
                <span>2022</span>
                <span>2023</span>
                <span>2024</span>
                <span>2025</span>
              </div>
            </div>
          </div>

          <!-- Interview Prep -->
          <div class="card" style="margin-bottom: 24px; background: white; border: 1px solid #e5e7eb;">
            <h3
              style="font-size: 18px; font-weight: 700; color: #111827; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
              üé§ Interview Prep
            </h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
              <div style="background: #f9fafb; padding: 16px; border-radius: 12px; border: 1px solid #e5e7eb;">
                <div style="font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px;">TECHNICAL</div>
                <p style="font-size: 14px; color: #111827; font-weight: 500;">Explain the difference between supervised
                  and unsupervised learning.</p>
              </div>
              <div style="background: #f9fafb; padding: 16px; border-radius: 12px; border: 1px solid #e5e7eb;">
                <div style="font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px;">BEHAVIORAL</div>
                <p style="font-size: 14px; color: #111827; font-weight: 500;">Describe a time you had to clean a messy
                  dataset. What was your approach?</p>
              </div>
              <div style="background: #f9fafb; padding: 16px; border-radius: 12px; border: 1px solid #e5e7eb;">
                <div style="font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px;">SITUATIONAL</div>
                <p style="font-size: 14px; color: #111827; font-weight: 500;">How would you explain a complex model to a
                  non-technical stakeholder?</p>
              </div>
            </div>
          </div>

          <!-- Alternative Careers Comparison Matrix -->
          <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
              <h3 class="section-title" style="margin: 0;">
                <span style="font-size: 24px; font-weight: 700;">üîÑ Alternative Career Paths</span>
              </h3>
              <div style="display: flex; gap: 8px; align-items: center;">
                <span style="font-size: 13px; color: #6b7280;">Sort by:</span>
                <select id="sort-alternatives"
                  style="padding: 6px 12px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 13px; cursor: pointer;">
                  <option value="confidence">Confidence</option>
                  <option value="salary">Salary</option>
                  <option value="demand">Demand</option>
                </select>
              </div>
            </div>
            <div id="alternatives-matrix" style="overflow-x: auto;">
              <!-- Matrix will be populated by JS -->
            </div>
          </div>

          <!-- Enhanced Career Roadmap -->
          <div class="card">
            <h3 class="section-title" style="margin-bottom: 24px;">
              <span style="font-size: 24px; font-weight: 700;">üó∫Ô∏è Your Personalized Roadmap</span>
            </h3>
            <div class="roadmap-container" id="res-roadmap">
              <!-- Populated by JS -->
            </div>
          </div>
        </div>
      </section>

      <!-- HISTORY SECTION -->
      <section id="history" class="section">
        <div class="page-header" style="display: flex; justify-content: space-between; align-items: center;">
          <div>
            <h1>Prediction History</h1>
            <p style="color: var(--color-text-muted);">View your past career predictions.</p>
          </div>
          <div style="display: flex; gap: 12px; align-items: center;">
            <input type="text" id="history-search" placeholder="Search by role..."
              style="padding: 10px 16px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px; width: 250px;">
            <button id="clear-history-btn" class="btn btn-outline">Clear History</button>
          </div>
        </div>

        <div
          style="background: white; border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); overflow: hidden;">
          <div class="list-header">
            <div>Role</div>
            <div>Date</div>
            <div>Confidence</div>
            <div>Salary</div>
          </div>
          <div id="history-list">
            <!-- Populated by JS -->
          </div>
        </div>
      </section>

      <!-- RESUME BUILDER SECTION -->
      <section id="resume" class="section">
        <div class="page-header">
          <h1>üìÑ Resume Builder</h1>
          <p style="color: var(--color-text-muted);">Generate a professional, ATS-friendly resume from your profile</p>
        </div>

        <!-- Document Type Tabs -->
        <div class="card" style="margin-bottom: 24px;">
          <div style="display: flex; gap: 8px; margin-bottom: 20px; border-bottom: 2px solid #e5e7eb;">
            <button id="tab-resume" class="doc-type-tab active" data-type="resume"
              style="flex: 1; padding: 12px; border: none; background: none; cursor: pointer; font-weight: 600; color: var(--color-primary); border-bottom: 3px solid var(--color-primary); transition: all 0.3s;">
              üìÑ Resume
            </button>
            <button id="tab-cover-letter" class="doc-type-tab" data-type="cover-letter"
              style="flex: 1; padding: 12px; border: none; background: none; cursor: pointer; font-weight: 600; color: #6b7280; border-bottom: 3px solid transparent; transition: all 0.3s;">
              üìù Cover Letter
            </button>
          </div>

          <!-- Resume Templates -->
          <div id="resume-templates-section">
            <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 16px;">Choose Template</h3>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
              <div id="template-modern" class="resume-template-card" data-template="modern"
                style="border: 2px solid var(--color-primary); padding: 16px; border-radius: 12px; cursor: pointer; text-align: center; background: #f0fdf4;">
                <div style="font-size: 32px; margin-bottom: 8px;">üìã</div>
                <div style="font-weight: 600; color: #111827;">Modern</div>
                <div style="font-size: 12px; color: #6b7280;">Clean & Professional</div>
              </div>
              <div id="template-classic" class="resume-template-card" data-template="classic"
                style="border: 2px solid #e5e7eb; padding: 16px; border-radius: 12px; cursor: pointer; text-align: center;">
                <div style="font-size: 32px; margin-bottom: 8px;">üìÑ</div>
                <div style="font-weight: 600; color: #111827;">Classic</div>
                <div style="font-size: 12px; color: #6b7280;">Traditional Format</div>
              </div>
              <div id="template-creative" class="resume-template-card" data-template="creative"
                style="border: 2px solid #e5e7eb; padding: 16px; border-radius: 12px; cursor: pointer; text-align: center;">
                <div style="font-size: 32px; margin-bottom: 8px;">üé®</div>
                <div style="font-weight: 600; color: #111827;">Creative</div>
                <div style="font-size: 12px; color: #6b7280;">Stand Out Design</div>
              </div>
            </div>
          </div>

          <!-- Cover Letter Section -->
          <div id="cover-letter-section" style="display: none;">
            <div
              style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding: 20px; border-radius: 12px; margin-bottom: 16px;">
              <h3 style="font-size: 18px; font-weight: 700; color: #0c4a6e; margin-bottom: 12px;">‚ú® AI Cover Letter
                Generator</h3>
              <p style="font-size: 14px; color: #075985; margin-bottom: 16px;">Create a personalized cover letter
                tailored to your target job</p>

              <div class="form-group" style="margin-bottom: 12px;">
                <label class="form-label" style="color: #0c4a6e; font-size: 13px; font-weight: 600;">Company
                  Name</label>
                <input type="text" id="cl-company" class="form-input" placeholder="e.g., Google, Microsoft, Amazon"
                  style="font-size: 14px;">
              </div>

              <div class="form-group" style="margin-bottom: 12px;">
                <label class="form-label" style="color: #0c4a6e; font-size: 13px; font-weight: 600;">Job Title</label>
                <input type="text" id="cl-job-title" class="form-input" placeholder="e.g., Senior Software Engineer"
                  style="font-size: 14px;">
              </div>

              <div class="form-group" style="margin-bottom: 12px;">
                <label class="form-label" style="color: #0c4a6e; font-size: 13px; font-weight: 600;">Why This Company?
                  (Optional)</label>
                <textarea id="cl-reason" class="form-input" rows="2"
                  placeholder="What excites you about this company or role?" style="font-size: 13px;"></textarea>
              </div>

              <div class="form-group" style="margin-bottom: 16px;">
                <label class="form-label" style="color: #0c4a6e; font-size: 13px; font-weight: 600;">Tone</label>
                <select id="cl-tone" class="form-select" style="font-size: 14px;">
                  <option value="professional">Professional & Formal</option>
                  <option value="enthusiastic">Enthusiastic & Energetic</option>
                  <option value="confident">Confident & Bold</option>
                  <option value="humble">Humble & Sincere</option>
                </select>
              </div>

              <button id="generate-cover-letter-btn" class="btn"
                style="width: 100%; background: #0284c7; color: white;">
                ‚ú® Generate Cover Letter
              </button>
            </div>
          </div>
        </div>

        <!-- NEW: Resume Versions Manager -->
        <div class="card" style="margin-bottom: 24px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h3 style="font-size: 18px; font-weight: 700;">üìö Your Resume Versions</h3>
            <button id="save-resume-version-btn" class="btn btn-outline" style="padding: 8px 16px; font-size: 13px;">
              üíæ Save Current Version
            </button>
          </div>
          <div id="resume-versions-list"
            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;">
            <div
              style="border: 2px dashed #e5e7eb; border-radius: 12px; padding: 20px; text-align: center; color: #9ca3af;">
              <div style="font-size: 32px; margin-bottom: 8px;">üìÑ</div>
              <div style="font-size: 13px;">No saved versions yet</div>
            </div>
          </div>
        </div>

        <!-- Resume Preview & Actions -->
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px;">
          <!-- Preview -->
          <div class="card" style="padding: 0; overflow: hidden;">
            <div
              style="padding: 16px; border-bottom: 1px solid #e5e7eb; background: #f9fafb; display: flex; justify-content: space-between; align-items: center;">
              <h3 style="font-size: 16px; font-weight: 600;">Preview</h3>
              <div style="display: flex; gap: 8px;">
                <button id="fullscreen-preview-btn" class="btn btn-outline" style="padding: 6px 12px; font-size: 12px;">
                  ‚õ∂ Fullscreen
                </button>
              </div>
            </div>
            <div id="resume-preview"
              style="padding: 40px; background: white; min-height: 600px; max-height: 800px; overflow-y: auto;">
              <!-- Resume will be rendered here -->
              <div style="text-align: center; padding: 100px 20px; color: #9ca3af;">
                <svg width="64" height="64" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                  style="margin: 0 auto 16px;">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">No Resume Generated</div>
                <div style="font-size: 14px;">Click "Generate Resume" to create your professional resume</div>
              </div>
            </div>
          </div>

          <!-- Actions & Tips -->
          <div>
            <div class="card" style="margin-bottom: 16px;">
              <button id="generate-resume-action-btn" class="btn" style="width: 100%; margin-bottom: 12px;">
                üéØ Generate Resume
              </button>
              <button id="download-resume-btn" class="btn btn-outline" style="width: 100%; margin-bottom: 8px;"
                disabled>
                ‚¨áÔ∏è Download
              </button>
              <button id="email-resume-btn" class="btn btn-outline" style="width: 100%;" disabled>
                ÔøΩ Email Resume
              </button>
            </div>

            <!-- NEW: Keyword Optimizer -->
            <div class="card" style="margin-bottom: 16px; background: #fef3c7; border: 2px solid #fde68a;">
              <h4 style="font-size: 14px; font-weight: 700; color: #78350f; margin-bottom: 12px;">üîë Keyword Optimizer
              </h4>
              <input type="text" id="target-job-title" class="form-input" placeholder="Enter target job title..."
                style="margin-bottom: 12px; font-size: 13px;">
              <button id="optimize-keywords-btn" class="btn"
                style="width: 100%; background: #f59e0b; color: white; font-size: 13px;">
                ‚ú® Optimize for ATS
              </button>
              <div id="keyword-suggestions" style="margin-top: 12px; display: none;">
                <div style="font-size: 12px; font-weight: 600; color: #92400e; margin-bottom: 8px;">Suggested Keywords:
                </div>
                <div id="keyword-tags" style="display: flex; flex-wrap: wrap; gap: 6px;"></div>
              </div>
            </div>

            <div class="card" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: none;">
              <h4 style="font-size: 14px; font-weight: 700; color: #78350f; margin-bottom: 12px;">üí° Resume Tips</h4>
              <ul style="font-size: 13px; color: #92400e; line-height: 1.8; padding-left: 20px; margin: 0;">
                <li>Keep it to 1-2 pages</li>
                <li>Use action verbs</li>
                <li>Quantify achievements</li>
                <li>Tailor to job description</li>
                <li>Proofread carefully</li>
                <li><strong>NEW:</strong> Include social links</li>
                <li><strong>NEW:</strong> Add 2-3 key projects</li>
              </ul>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Email Resume Modal -->
  <div id="email-resume-modal"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1001; align-items: center; justify-content: center;">
    <div
      style="background: white; width: 500px; max-width: 90%; border-radius: 16px; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);">
      <div
        style="padding: 20px 24px; border-bottom: 1px solid #e5e7eb; background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);">
        <h3 style="font-size: 20px; font-weight: 700; color: #1e40af; margin-bottom: 4px;">üìß Email Your Resume</h3>
        <p style="font-size: 13px; color: #3b82f6;">Send your resume directly to a recruiter or hiring manager</p>
      </div>
      <div style="padding: 24px;">
        <div class="form-group" style="margin-bottom: 16px;">
          <label class="form-label">Recipient Email</label>
          <input type="email" id="recipient-email" class="form-input" placeholder="recruiter@company.com">
        </div>
        <div class="form-group" style="margin-bottom: 16px;">
          <label class="form-label">Subject</label>
          <input type="text" id="email-subject" class="form-input" placeholder="Application for [Job Title]">
        </div>
        <div class="form-group" style="margin-bottom: 20px;">
          <label class="form-label">Message (Optional)</label>
          <textarea id="email-message" class="form-input" rows="4" placeholder="Dear Hiring Manager,

I am writing to express my interest in..."></textarea>
        </div>
        <div style="display: flex; gap: 12px;">
          <button id="send-email-btn" class="btn btn-primary" style="flex: 1;">
            üì§ Send Resume
          </button>
          <button id="cancel-email-btn" class="btn btn-outline" style="flex: 1;">
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Resume Preview Modal -->
  <div id="resume-preview-modal"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div
      style="background: white; width: 90%; height: 90%; border-radius: 16px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);">
      <div
        style="padding: 16px 24px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
        <h3 style="font-size: 18px; font-weight: 600; color: #111827;">Resume Preview</h3>
        <button id="close-resume-modal-btn"
          style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">&times;</button>
      </div>
      <div style="flex: 1; background: #f3f4f6; padding: 0;">
        <iframe id="resume-preview-frame" style="width: 100%; height: 100%; border: none;"></iframe>
      </div>
    </div>
  </div>

  <script src="js/config.js"></script>
  <script src="js/utils.js"></script>
  <script>
    console.log('Dashboard script loaded');
    // --- CONFIG ALIASES ---
    const API_BASE_URL = CONFIG.API_BASE_URL;
    const showToast = Utils.showToast;


    // Profile Completion Calculator
    function calculateProfileCompletion() {
      const fields = [
        document.getElementById('p-name')?.value,
        document.getElementById('p-email')?.value,
        document.getElementById('p-degree')?.value,
        document.getElementById('p-major')?.value,
        document.getElementById('p-cgpa')?.value,
        document.getElementById('p-experience')?.value,
      ];

      const filledFields = fields.filter(f => f && f.trim() !== '').length;
      const totalFields = fields.length + 2; // +2 for skills and certs

      // Check if skills and certs have values with proper null checks
      let hasSkills = false;
      let hasCerts = false;

      try {
        if (typeof window.app !== 'undefined' && window.app && window.app.tagInputs) {
          const skillTags = window.app.tagInputs['p-skills']?.getTags();
          const certTags = window.app.tagInputs['p-certs']?.getTags();
          hasSkills = skillTags && skillTags.length > 0;
          hasCerts = certTags && certTags.length > 0;
        }
      } catch (e) {
        console.warn('Error checking tags:', e);
      }

      const completion = Math.round(((filledFields + (hasSkills ? 1 : 0) + (hasCerts ? 1 : 0)) / totalFields) * 100);
      return completion;
    }

    // Form Validation
    function validateField(field, rules) {
      const value = field.value.trim();
      let isValid = true;
      let errorMessage = '';

      if (rules.required && !value) {
        isValid = false;
        errorMessage = 'This field is required';
      } else if (rules.email && value && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
        isValid = false;
        errorMessage = 'Please enter a valid email';
      } else if (rules.min && value && parseFloat(value) < rules.min) {
        isValid = false;
        errorMessage = `Minimum value is ${rules.min}`;
      } else if (rules.max && value && parseFloat(value) > rules.max) {
        isValid = false;
        errorMessage = `Maximum value is ${rules.max}`;
      }

      // Update UI
      if (value) {
        field.classList.remove('invalid', 'valid');
        field.classList.add(isValid ? 'valid' : 'invalid');
      } else {
        field.classList.remove('invalid', 'valid');
      }

      // Show/hide error
      let errorEl = field.nextElementSibling;
      if (!errorEl || !errorEl.classList.contains('form-error')) {
        errorEl = document.createElement('div');
        errorEl.className = 'form-error';
        field.parentNode.insertBefore(errorEl, field.nextSibling);
      }
      errorEl.textContent = errorMessage;
      errorEl.classList.toggle('show', !isValid && value);

      return isValid;
    }

    // Search/Filter History
    function filterHistory(searchTerm) {
      const historyItems = document.querySelectorAll('#history-list .list-item');
      let visibleCount = 0;

      historyItems.forEach(item => {
        const role = item.querySelector('div:first-child')?.textContent.toLowerCase() || '';
        const matches = role.includes(searchTerm.toLowerCase());
        item.style.display = matches ? 'grid' : 'none';
        if (matches) visibleCount++;
      });

      // Show "no results" message if needed
      if (visibleCount === 0 && searchTerm) {
        const noResults = document.createElement('div');
        noResults.id = 'no-search-results';
        noResults.style.cssText = 'text-align: center; padding: 40px; color: #9ca3af;';
        noResults.innerHTML = `
          <div style="font-size: 48px; margin-bottom: 12px;">üîç</div>
          <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">No Results Found</div>
          <div style="font-size: 14px;">Try a different search term</div>
        `;
        document.getElementById('history-list').appendChild(noResults);
      } else {
        document.getElementById('no-search-results')?.remove();
      }
    }

    // --- DATA & CONSTANTS ---
    // We will fetch options from backend if possible, or use defaults
    let SKILLS_DB = [];
    let CERTS_DB = [];

    // --- TAG INPUT COMPONENT ---
    class TagInput {
      constructor(containerId, suggestions = []) {
        this.container = document.getElementById(containerId);
        if (!this.container) {
          console.warn(`TagInput: Container "${containerId}" not found`);
          return;
        }
        this.input = this.container.querySelector('.tag-input-field');
        this.list = this.container.querySelector('.suggestions-list');
        if (!this.input || !this.list) {
          console.warn(`TagInput: Required elements not found in "${containerId}"`);
          return;
        }
        this.suggestions = suggestions;
        this.tags = [];

        this.init();
      }

      init() {
        if (!this.input || !this.list) return;

        this.input.addEventListener('input', (e) => this.handleInput(e));
        this.input.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            e.preventDefault();
            this.addTag(this.input.value);
          }
        });

        document.addEventListener('click', (e) => {
          if (this.container && !this.container.contains(e.target)) {
            if (this.list) this.list.style.display = 'none';
          }
        });
      }

      handleInput(e) {
        if (!this.list) return;

        const val = e.target.value.toLowerCase();
        if (!val) {
          this.list.style.display = 'none';
          return;
        }

        const matches = this.suggestions.filter(s =>
          s.toLowerCase().includes(val) && !this.tags.includes(s)
        ).slice(0, 10);

        this.renderSuggestions(matches);
      }

      renderSuggestions(matches) {
        if (!this.list) return;

        this.list.innerHTML = '';
        if (matches.length === 0) {
          this.list.style.display = 'none';
          return;
        }

        matches.forEach(match => {
          const div = document.createElement('div');
          div.className = 'suggestion-item';
          div.textContent = match;
          div.addEventListener('click', () => this.addTag(match));
          this.list.appendChild(div);
        });

        this.list.style.display = 'block';
      }

      addTag(text) {
        if (!this.input) return;

        const cleanText = text.trim();
        if (!cleanText || this.tags.includes(cleanText)) return;

        this.tags.push(cleanText);
        this.renderTags();
        this.input.value = '';
        if (this.list) this.list.style.display = 'none';
        this.input.focus();
      }

      removeTag(index) {
        this.tags.splice(index, 1);
        this.renderTags();
      }

      renderTags() {
        if (!this.container || !this.input) return;

        const existingTags = this.container.querySelectorAll('.tag');
        existingTags.forEach(t => t.remove());

        this.tags.forEach((tag, index) => {
          const tagEl = document.createElement('div');
          tagEl.className = 'tag';

          const textNode = document.createTextNode(tag + ' ');
          tagEl.appendChild(textNode);

          const removeBtn = document.createElement('span');
          removeBtn.className = 'tag-remove';
          removeBtn.textContent = '√ó';
          removeBtn.addEventListener('click', () => this.removeTag(index));

          tagEl.appendChild(removeBtn);
          this.container.insertBefore(tagEl, this.input);
        });
      }

      getTags() {
        return this.tags || [];
      }

      setTags(newTags) {
        this.tags = [...(newTags || [])];
        this.renderTags();
      }

      setSuggestions(newSuggestions) {
        this.suggestions = newSuggestions || [];
      }
    }

    // --- MAIN APP LOGIC ---
    window.app = {
      user: null,
      tagInputs: {},
      charts: {},
      activeSection: 'home', // Track active section for navigation

      init(user) {
        this.user = user;
        this.renderUserInfo();
        this.initTagInputs(); // Init with empty first
        this.loadOptions(); // Then load data
        this.setupNavigation();
        this.setupForms();
        this.setupEventListeners(); // NEW: Setup all event listeners
        this.loadProfile();
        this.loadHistory();
      },

      getHeaders() {
        const token = localStorage.getItem('authToken');
        return {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        };
      },

      renderUserInfo() {
        if (this.user) {
          document.getElementById('welcome-msg').textContent = `Welcome back, ${this.user.username}! üëã`;
          document.getElementById('user-name-display').textContent = this.user.username.charAt(0).toUpperCase() + this.user.username.slice(1);
          document.getElementById('header-avatar').src = `https://ui-avatars.com/api/?name=${this.user.username}&background=random`;
        }
      },

      async loadOptions() {
        try {
          const res = await fetch(`${API_BASE_URL}/api/get-options`);
          if (res.status === 401) {
            this.logout();
            return;
          }
          if (res.ok) {
            const data = await res.json();
            // Populate dropdowns
            this.populateSelect('p-degree', data.Degree);
            this.populateSelect('pr-degree', data.Degree);
            this.populateSelect('p-major', data.Major);
            this.populateSelect('pr-major', data.Major);
            this.populateSelect('p-specialization', data.Specialization);
            this.populateSelect('pr-specialization', data.Specialization);
            this.populateSelect('pr-industry', data['Preferred Industry']);

            // Update Tag Inputs with full data
            if (data.Skills) {
              if (this.tagInputs['p-skills']) this.tagInputs['p-skills'].setSuggestions(data.Skills);
              if (this.tagInputs['pr-skills']) this.tagInputs['pr-skills'].setSuggestions(data.Skills);
            }
            if (data.Certifications) {
              if (this.tagInputs['p-certs']) this.tagInputs['p-certs'].setSuggestions(data.Certifications);
              if (this.tagInputs['pr-certs']) this.tagInputs['pr-certs'].setSuggestions(data.Certifications);
            }
          }
        } catch (e) {
          console.error('Failed to load options', e);
        }
      },

      populateSelect(id, options) {
        const select = document.getElementById(id);
        if (!select) return;

        // Keep first option (placeholder)
        const first = select.options[0];
        select.innerHTML = '';
        select.appendChild(first);

        if (options && Array.isArray(options)) {
          options.forEach(opt => {
            const el = document.createElement('option');
            el.value = opt;
            el.textContent = opt;
            select.appendChild(el);
          });
        }
      },

      initTagInputs() {
        // Initial empty suggestions, will be populated by loadOptions
        // Only initialize if containers exist
        try {
          const containers = ['p-skills-container', 'p-certs-container', 'pr-skills-container', 'pr-certs-container'];
          const keys = ['p-skills', 'p-certs', 'pr-skills', 'pr-certs'];

          containers.forEach((containerId, idx) => {
            if (document.getElementById(containerId)) {
              this.tagInputs[keys[idx]] = new TagInput(containerId, []);
            } else {
              console.warn(`TagInput container ${containerId} not found, skipping initialization`);
            }
          });
        } catch (e) {
          console.error('Error initializing tag inputs:', e);
        }
      },

      removeTagInstance(containerId, index) {
        if (!containerId || index === undefined) return;

        const key = containerId.replace('-container', '').replace('container', '');
        let mapKey = '';
        if (containerId === 'p-skills-container') mapKey = 'p-skills';
        if (containerId === 'p-certs-container') mapKey = 'p-certs';
        if (containerId === 'pr-skills-container') mapKey = 'pr-skills';
        if (containerId === 'pr-certs-container') mapKey = 'pr-certs';

        if (mapKey && this.tagInputs && this.tagInputs[mapKey]) {
          this.tagInputs[mapKey].removeTag(index);
        }
      },

      setupNavigation() {
        // Handle browser back/forward buttons
        window.onpopstate = (event) => {
          if (event.state && event.state.page) {
            this.nav(event.state.page, false);
          } else {
            this.nav('home', false);
          }
        };

        // Handle initial load based on URL hash or default
        const hash = window.location.hash.replace('#', '');
        if (hash && ['home', 'profile', 'predict', 'history'].includes(hash)) {
          this.nav(hash, false);
        } else {
          this.nav('home', true); // Replace state for initial load
        }
      },

      nav(sectionId, addToHistory = true) {
        this.activeSection = sectionId;

        // Update pills
        document.querySelectorAll('.nav-pill').forEach(el => el.classList.remove('active'));
        const activePill = document.getElementById(`nav-${sectionId}`);
        if (activePill) activePill.classList.add('active');

        // Show section
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        const activeSection = document.getElementById(sectionId);
        if (activeSection) activeSection.classList.add('active');

        // Scroll to top
        document.querySelector('.main-content').scrollTop = 0;

        if (addToHistory) {
          history.pushState({ page: sectionId }, '', `#${sectionId}`);
        }

        if (sectionId === 'home') {
          this.renderHome();
        } else if (sectionId === 'profile') {
          this.loadProfile();
        } else if (sectionId === 'history') {
          this.loadHistory();
        } else if (sectionId === 'predict') {
          this.prefillPredictForm();
        }
      },

      prefillPredictForm() {
        // If predict form is empty, try to fill from profile
        if (document.getElementById('pr-degree').value === '') {
          document.getElementById('pr-degree').value = document.getElementById('p-degree').value;
          document.getElementById('pr-major').value = document.getElementById('p-major').value;
          document.getElementById('pr-specialization').value = document.getElementById('p-specialization').value;
          document.getElementById('pr-cgpa').value = document.getElementById('p-cgpa').value;
          document.getElementById('pr-experience').value = document.getElementById('p-experience').value;

          this.tagInputs['pr-skills'].setTags(this.tagInputs['p-skills'].getTags());
          this.tagInputs['pr-certs'].setTags(this.tagInputs['p-certs'].getTags());
        }
      },

      setupForms() {
        // Profile Form
        document.getElementById('profile-form').addEventListener('submit', async (e) => {
          e.preventDefault();

          if (!this.user || !this.user.email) {
            showToast('User session invalid. Please login again.', 'error');
            return;
          }

          // Save full profile to localStorage with user-specific key
          const localProfile = {
            name: document.getElementById('p-name').value,
            email: document.getElementById('p-email').value,
            degree: document.getElementById('p-degree').value,
            major: document.getElementById('p-major').value,
            specialization: document.getElementById('p-specialization').value,
            cgpa: document.getElementById('p-cgpa').value,
            experience: document.getElementById('p-experience').value,
            skills: this.tagInputs['p-skills'].getTags(),
            certs: this.tagInputs['p-certs'].getTags(),
            linkedin: document.getElementById('p-linkedin').value,
            github: document.getElementById('p-github').value,
            portfolio: document.getElementById('p-portfolio').value,
            projects: this.getProjectsData(),
            achievements: this.getAchievementsData(),
            languages: this.getLanguagesData()
          };
          localStorage.setItem(`user_profile_${this.user.email}`, JSON.stringify(localProfile));

          showToast('Profile saved successfully!', 'success');
          const completion = calculateProfileCompletion();
          document.getElementById('profile-completion-percent').textContent = completion + '%';
          document.getElementById('profile-completion-bar').style.width = completion + '%';
          this.renderHome();
        });

        // Predict Form
        document.getElementById('predict-form').addEventListener('submit', (e) => {
          e.preventDefault();
          this.generatePrediction();
        });

        // Add validation listeners
        const validationRules = {
          'p-name': { required: true },
          'p-email': { required: true, email: true },
          'p-cgpa': { required: true, min: 0, max: 10 },
          'p-experience': { required: true, min: 0 },
          'pr-cgpa': { required: true, min: 0, max: 10 },
          'pr-experience': { required: true, min: 0 }
        };

        Object.keys(validationRules).forEach(fieldId => {
          const field = document.getElementById(fieldId);
          if (field) {
            field.addEventListener('blur', () => {
              validateField(field, validationRules[fieldId]);
            });
            field.addEventListener('input', () => {
              if (field.classList.contains('invalid')) {
                validateField(field, validationRules[fieldId]);
              }
            });
          }
        });
      },

      setupEventListeners() {
        // Navigation pills
        document.querySelectorAll('.nav-pill').forEach(pill => {
          pill.addEventListener('click', (e) => {
            e.preventDefault();
            const section = pill.getAttribute('data-section');
            if (section) {
              this.nav(section);
            }
            return false;
          });
        });

        // Logout button
        const logoutBtn = document.getElementById('logout-btn');
        if (logoutBtn) {
          logoutBtn.addEventListener('click', () => this.logout());
        }

        // Mobile menu toggle
        const mobileToggle = document.getElementById('mobile-menu-toggle');
        if (mobileToggle) {
          mobileToggle.addEventListener('click', () => {
            document.querySelector('.nav-pills')?.classList.toggle('show');
          });
        }

        // Banner buttons
        const bannerPredictBtn = document.getElementById('banner-predict-btn');
        if (bannerPredictBtn) {
          bannerPredictBtn.addEventListener('click', () => this.nav('predict'));
        }

        const bannerProfileBtn = document.getElementById('banner-profile-btn');
        if (bannerProfileBtn) {
          bannerProfileBtn.addEventListener('click', () => this.nav('profile'));
        }

        // Action cards
        document.querySelectorAll('.action-card-premium').forEach(card => {
          card.addEventListener('click', () => {
            const navTarget = card.getAttribute('data-nav');
            if (navTarget) {
              this.nav(navTarget);
            }
          });
        });

        // Profile save button
        const saveProfileBtn = document.getElementById('save-profile-btn');
        if (saveProfileBtn) {
          saveProfileBtn.addEventListener('click', () => {
            document.getElementById('profile-form-submit')?.click();
          });
        }

        // History search
        const historySearch = document.getElementById('history-search');
        if (historySearch) {
          historySearch.addEventListener('input', (e) => {
            filterHistory(e.target.value);
          });
        }

        // Clear history button
        const clearHistoryBtn = document.getElementById('clear-history-btn');
        if (clearHistoryBtn) {
          clearHistoryBtn.addEventListener('click', () => this.clearHistory());
        }

        // Resume template selection
        document.querySelectorAll('.resume-template-card').forEach(card => {
          card.addEventListener('click', () => {
            const template = card.getAttribute('data-template');
            if (template) {
              this.selectResumeTemplate(template);
            }
          });
        });

        // Resume generation and download
        const generateResumeBtn = document.getElementById('generate-resume-action-btn');
        if (generateResumeBtn) {
          generateResumeBtn.addEventListener('click', () => this.generateResume());
        }

        const downloadResumeBtn = document.getElementById('download-resume-btn');
        if (downloadResumeBtn) {
          downloadResumeBtn.addEventListener('click', () => this.downloadResume());
        }

        // NEW: Profile enhancement buttons
        const addProjectBtn = document.getElementById('add-project-btn');
        if (addProjectBtn) {
          addProjectBtn.addEventListener('click', () => this.addProject());
        }

        const addAchievementBtn = document.getElementById('add-achievement-btn');
        if (addAchievementBtn) {
          addAchievementBtn.addEventListener('click', () => this.addAchievement());
        }

        const addLanguageBtn = document.getElementById('add-language-btn');
        if (addLanguageBtn) {
          addLanguageBtn.addEventListener('click', () => this.addLanguage());
        }

        // NEW: Resume builder enhancement buttons
        const analyzeCurrentBtn = document.getElementById('analyze-current-btn');
        if (analyzeCurrentBtn) {
          analyzeCurrentBtn.addEventListener('click', () => this.analyzeATS());
        }

        const uploadResumeBtn = document.getElementById('upload-resume-btn');
        if (uploadResumeBtn) {
          uploadResumeBtn.addEventListener('click', () => {
            document.getElementById('upload-resume-file').click();
          });
        }

        const uploadResumeFile = document.getElementById('upload-resume-file');
        if (uploadResumeFile) {
          uploadResumeFile.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
              showToast('Resume uploaded! Analyzing...', 'info');
              setTimeout(() => this.analyzeATS(), 1000);
            }
          });
        }

        const optimizeKeywordsBtn = document.getElementById('optimize-keywords-btn');
        if (optimizeKeywordsBtn) {
          optimizeKeywordsBtn.addEventListener('click', () => this.optimizeKeywords());
        }

        const saveResumeVersionBtn = document.getElementById('save-resume-version-btn');
        if (saveResumeVersionBtn) {
          saveResumeVersionBtn.addEventListener('click', () => this.saveResumeVersion());
        }

        // NEW: Email resume button
        const emailResumeBtn = document.getElementById('email-resume-btn');
        if (emailResumeBtn) {
          emailResumeBtn.addEventListener('click', () => this.showEmailModal());
        }

        const sendEmailBtn = document.getElementById('send-email-btn');
        if (sendEmailBtn) {
          sendEmailBtn.addEventListener('click', () => this.sendResumeEmail());
        }

        const cancelEmailBtn = document.getElementById('cancel-email-btn');
        if (cancelEmailBtn) {
          cancelEmailBtn.addEventListener('click', () => {
            document.getElementById('email-resume-modal').style.display = 'none';
          });
        }

        // NEW: Document type tabs (Resume vs Cover Letter)
        document.querySelectorAll('.doc-type-tab').forEach(tab => {
          tab.addEventListener('click', () => {
            const type = tab.getAttribute('data-type');
            this.switchDocumentType(type);
          });
        });

        // NEW: Cover letter generator
        const generateCoverLetterBtn = document.getElementById('generate-cover-letter-btn');
        if (generateCoverLetterBtn) {
          generateCoverLetterBtn.addEventListener('click', () => this.generateCoverLetter());
        }

        const fullscreenPreviewBtn = document.getElementById('fullscreen-preview-btn');
        if (fullscreenPreviewBtn) {
          fullscreenPreviewBtn.addEventListener('click', () => {
            const preview = document.getElementById('resume-preview');
            if (preview.requestFullscreen) {
              preview.requestFullscreen();
            }
          });
        }

        // Keyword tags delegate
        document.getElementById('keyword-tags')?.addEventListener('click', (e) => {
          if (e.target.classList.contains('keyword-tag')) {
            const skill = e.target.getAttribute('data-skill');
            this.addSkillToProfile(skill);
          }
        });

        // Resume versions delegate
        document.getElementById('resume-versions-list')?.addEventListener('click', (e) => {
          const item = e.target.closest('.resume-version-item');
          if (item) {
            const id = item.getAttribute('data-id');
            this.loadResumeVersion(parseInt(id));
          }
        });
      },

      loadProfile() {
        // Clear all fields first for new users
        document.getElementById('p-name').value = '';
        document.getElementById('p-email').value = '';
        document.getElementById('p-degree').value = '';
        document.getElementById('p-major').value = '';
        document.getElementById('p-specialization').value = '';
        document.getElementById('p-cgpa').value = '';
        document.getElementById('p-experience').value = '';
        this.tagInputs['p-skills'].setTags([]);
        this.tagInputs['p-certs'].setTags([]);

        if (!this.user || !this.user.email) return;

        // Load from localStorage using user-specific key
        const saved = localStorage.getItem(`user_profile_${this.user.email}`);
        if (saved) {
          try {
            const p = JSON.parse(saved);
            document.getElementById('p-name').value = p.name || '';
            document.getElementById('p-email').value = p.email || '';
            document.getElementById('p-degree').value = p.degree || '';
            document.getElementById('p-major').value = p.major || '';
            document.getElementById('p-specialization').value = p.specialization || '';
            document.getElementById('p-cgpa').value = p.cgpa || '';
            document.getElementById('p-experience').value = p.experience || '';

            // Update Header
            if (this.user.username) {
              document.getElementById('profile-name-display').textContent = this.user.username.charAt(0).toUpperCase() + this.user.username.slice(1);
              document.getElementById('profile-avatar-lg').src = `https://ui-avatars.com/api/?name=${this.user.username}&background=random&size=160`;
            }

            this.tagInputs['p-skills'].setTags(p.skills || []);
            this.tagInputs['p-certs'].setTags(p.certs || []);

            // Load new fields
            document.getElementById('p-linkedin').value = p.linkedin || '';
            document.getElementById('p-github').value = p.github || '';
            document.getElementById('p-portfolio').value = p.portfolio || '';

            // Load projects
            if (p.projects && p.projects.length > 0) {
              document.getElementById('projects-list').innerHTML = '';
              p.projects.forEach(proj => {
                this.addProject();
                const lastProject = document.querySelector('.project-item:last-child');
                if (lastProject) {
                  lastProject.querySelector('.project-title').value = proj.title || '';
                  lastProject.querySelector('.project-desc').value = proj.description || '';
                  lastProject.querySelector('.project-tech').value = proj.technologies || '';
                  lastProject.querySelector('.project-link').value = proj.link || '';
                }
              });
            }

            // Load achievements
            if (p.achievements && p.achievements.length > 0) {
              document.getElementById('achievements-list').innerHTML = '';
              p.achievements.forEach(ach => {
                this.addAchievement();
                const lastAchievement = document.querySelector('.achievement-item:last-child');
                if (lastAchievement) {
                  lastAchievement.querySelector('.achievement-text').value = ach;
                }
              });
            }

            // Load languages
            if (p.languages && p.languages.length > 0) {
              document.getElementById('languages-list').innerHTML = '';
              p.languages.forEach(lang => {
                this.addLanguage();
                const lastLanguage = document.querySelector('.language-item:last-child');
                if (lastLanguage) {
                  lastLanguage.querySelector('.language-name').value = lang.name || '';
                  lastLanguage.querySelector('.language-level').value = lang.level || 'Intermediate';
                }
              });
            }
          } catch (e) {
            console.error('Error loading profile:', e);
          }
        } else {
          // For new users (or no saved profile), populate basic info
          document.getElementById('p-name').value = this.user.username || '';
          document.getElementById('p-email').value = this.user.email || '';

          // Update Header for new users too
          if (this.user.username) {
            document.getElementById('profile-name-display').textContent = this.user.username.charAt(0).toUpperCase() + this.user.username.slice(1);
            document.getElementById('profile-avatar-lg').src = `https://ui-avatars.com/api/?name=${this.user.username}&background=random&size=160`;
          }
        }

        // Update profile completion
        setTimeout(() => {
          const completion = calculateProfileCompletion();
          document.getElementById('profile-completion-percent').textContent = completion + '%';
          document.getElementById('profile-completion-bar').style.width = completion + '%';
        }, 100);
      },

      async loadHistory() {
        try {
          const res = await fetch(`${API_BASE_URL}/api/prediction-history`, {
            headers: this.getHeaders()
          });
          if (res.status === 401) {
            this.logout();
            return;
          }
          if (res.ok) {
            const data = await res.json();
            this.renderHistoryList(data.history);
            this.updateStats(data.history);
          }
        } catch (e) {
          console.error('Error loading history', e);
        }
      },

      updateStats(history) {
        document.getElementById('stat-total').textContent = history.length;

        // Skills count from profile
        const skillsCount = this.tagInputs['p-skills'] ? this.tagInputs['p-skills'].getTags().length : 0;

        // Profile completion
        let filled = 0;
        if (document.getElementById('p-name').value) filled++;
        if (document.getElementById('p-degree').value) filled++;
        if (document.getElementById('p-major').value) filled++;
        if (skillsCount > 0) filled++;
        const completion = Math.round((filled / 4) * 100);
        document.getElementById('stat-completion').textContent = completion + '%';

        // Update donut chart
        const donutChart = document.getElementById('donut-chart');
        if (donutChart) {
          const percentage = completion;
          donutChart.style.background = `conic-gradient(var(--color-primary) 0% ${percentage}%, #e5e7eb ${percentage}% 100%)`;
        }
      },

      renderHome() {
        // Refresh stats when returning to home
        this.loadHistory();
      },

      renderHistoryList(history) {
        const list = document.getElementById('history-list');
        list.innerHTML = '';

        if (!history || history.length === 0) {
          list.innerHTML = '<div style="padding: 24px; text-align: center; color: #9ca3af;">No history found.</div>';
          return;
        }

        history.forEach(item => {
          const div = document.createElement('div');
          div.className = 'list-item';
          div.innerHTML = `
                        <div style="font-weight:500">${item.predicted_role}</div>
                        <div>${item.time_ago}</div>
                        <div><span style="background: #ecfdf5; color: #059669; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">${item.confidence}%</span></div>
                        <div>${item.salary_range}</div>
                    `;
          list.appendChild(div);
        });
      },

      async clearHistory() {
        // Backend doesn't have clear history endpoint yet, so we just alert
        showToast('History cleared successfully!', 'success');
        document.getElementById('history-list').innerHTML = '<div style="text-align: center; padding: 60px 20px; color: #9ca3af;"><div style="font-size: 48px; margin-bottom: 16px;">üì≠</div><div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">No History Yet</div><div style="font-size: 14px;">Your prediction history will appear here</div></div>';
        this.updateStats();
      },

      logout() {
        localStorage.removeItem('authToken');
        localStorage.removeItem('userInfo');
        window.location.href = 'login.html';
      },

      // Profile Enhancement Methods
      projects: [],
      achievements: [],
      languages: [],

      addProject() {
        const projectId = Date.now();
        const projectHTML = `
          <div class="project-item" data-id="${projectId}" style="background: #f9fafb; padding: 16px; border-radius: 12px; border: 1px solid #e5e7eb;">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
              <input type="text" class="form-input project-title" placeholder="Project Title" style="font-weight: 600; font-size: 15px; flex: 1; margin-right: 12px;">
              <button type="button" class="remove-project-btn" data-id="${projectId}" style="background: #fee2e2; color: #dc2626; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;">Remove</button>
            </div>
            <textarea class="form-input project-desc" placeholder="Project description, technologies used, your role..." rows="3" style="margin-bottom: 12px; font-size: 13px;"></textarea>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <input type="text" class="form-input project-tech" placeholder="Technologies (e.g., React, Node.js)" style="font-size: 13px;">
              <input type="url" class="form-input project-link" placeholder="Project Link (optional)" style="font-size: 13px;">
            </div>
          </div>
        `;

        const placeholder = document.querySelector('#projects-list > div[style*="dashed"]');
        if (placeholder) placeholder.remove();

        document.getElementById('projects-list').insertAdjacentHTML('beforeend', projectHTML);

        // Add remove listener
        document.querySelector(`.remove-project-btn[data-id="${projectId}"]`).addEventListener('click', () => {
          document.querySelector(`.project-item[data-id="${projectId}"]`).remove();
          if (document.querySelectorAll('.project-item').length === 0) {
            document.getElementById('projects-list').innerHTML = '<div style="text-align: center; padding: 40px; color: #9ca3af; border: 2px dashed #e5e7eb; border-radius: 12px;"><div style="font-size: 32px; margin-bottom: 8px;">üìÅ</div><div style="font-size: 14px;">No projects added yet.</div></div>';
          }
        });
      },

      addAchievement() {
        const achievementId = Date.now();
        const achievementHTML = `
          <div class="achievement-item" data-id="${achievementId}" style="display: flex; gap: 12px; align-items: start; background: #f9fafb; padding: 12px; border-radius: 8px; border: 1px solid #e5e7eb;">
            <div style="font-size: 24px;">üèÜ</div>
            <input type="text" class="form-input achievement-text" placeholder="Achievement or award description" style="flex: 1; font-size: 14px;">
            <button type="button" class="remove-achievement-btn" data-id="${achievementId}" style="background: #fee2e2; color: #dc2626; border: none; padding: 6px 10px; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 600;">√ó</button>
          </div>
        `;
        document.getElementById('achievements-list').insertAdjacentHTML('beforeend', achievementHTML);

        document.querySelector(`.remove-achievement-btn[data-id="${achievementId}"]`).addEventListener('click', () => {
          document.querySelector(`.achievement-item[data-id="${achievementId}"]`).remove();
        });
      },

      addLanguage() {
        const languageId = Date.now();
        const languageHTML = `
          <div class="language-item" data-id="${languageId}" style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 12px; align-items: center;">
            <input type="text" class="form-input language-name" placeholder="Language (e.g., English)" style="font-size: 14px;">
            <select class="form-select language-level" style="font-size: 14px;">
              <option value="Native">Native</option>
              <option value="Fluent">Fluent</option>
              <option value="Intermediate" selected>Intermediate</option>
              <option value="Basic">Basic</option>
            </select>
            <button type="button" class="remove-language-btn" data-id="${languageId}" style="background: #fee2e2; color: #dc2626; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 600;">√ó</button>
          </div>
        `;
        document.getElementById('languages-list').insertAdjacentHTML('beforeend', languageHTML);

        document.querySelector(`.remove-language-btn[data-id="${languageId}"]`).addEventListener('click', () => {
          document.querySelector(`.language-item[data-id="${languageId}"]`).remove();
        });
      },

      getProjectsData() {
        const projects = [];
        document.querySelectorAll('.project-item').forEach(item => {
          projects.push({
            title: item.querySelector('.project-title').value,
            description: item.querySelector('.project-desc').value,
            technologies: item.querySelector('.project-tech').value,
            link: item.querySelector('.project-link').value
          });
        });
        return projects;
      },

      getAchievementsData() {
        const achievements = [];
        document.querySelectorAll('.achievement-item').forEach(item => {
          const text = item.querySelector('.achievement-text').value;
          if (text) achievements.push(text);
        });
        return achievements;
      },

      getLanguagesData() {
        const languages = [];
        document.querySelectorAll('.language-item').forEach(item => {
          languages.push({
            name: item.querySelector('.language-name').value,
            level: item.querySelector('.language-level').value
          });
        });
        return languages;
      },

      // Resume Builder Methods
      selectedTemplate: 'modern',
      generatedResumeHTML: null,
      resumeVersions: [],
      atsScore: 0,

      selectResumeTemplate(template) {
        this.selectedTemplate = template;
        // Update UI
        document.querySelectorAll('.resume-template-card').forEach(card => {
          card.style.border = '2px solid #e5e7eb';
          card.style.background = 'white';
        });
        const selected = document.getElementById(`template-${template}`);
        selected.style.border = '2px solid var(--color-primary)';
        selected.style.background = '#f0fdf4';
      },

      analyzeATS() {
        // Simulate ATS analysis
        const profile = this.getFullProfile();

        // Calculate score based on profile completeness
        let score = 0;
        if (profile.name && profile.name !== 'Your Name') score += 10;
        if (profile.email && profile.email.includes('@')) score += 10;
        if (profile.skills.length > 3) score += 20;
        if (profile.experience > 0) score += 15;
        if (profile.projects.length > 0) score += 20;
        if (profile.certs.length > 0) score += 15;
        if (profile.linkedin || profile.github) score += 10;

        this.atsScore = Math.min(score, 100);

        // Show results
        document.getElementById('ats-score-display').style.display = 'block';
        document.getElementById('ats-analysis-results').style.display = 'block';
        document.getElementById('ats-score-value').textContent = this.atsScore;

        // Update score color
        const scoreEl = document.getElementById('ats-score-display').querySelector('div[style*="border"]');
        if (this.atsScore >= 80) {
          scoreEl.style.borderColor = '#10b981';
          document.getElementById('ats-score-value').style.color = '#10b981';
        } else if (this.atsScore >= 60) {
          scoreEl.style.borderColor = '#f59e0b';
          document.getElementById('ats-score-value').style.color = '#f59e0b';
        } else {
          scoreEl.style.borderColor = '#ef4444';
          document.getElementById('ats-score-value').style.color = '#ef4444';
        }

        // Update metrics
        document.getElementById('ats-keywords').textContent = `${profile.skills.length}/20`;
        document.getElementById('ats-formatting').textContent = 'Good';

        // Recommendations
        const recommendations = [];
        if (profile.skills.length < 5) recommendations.push('Add more relevant skills to your profile');
        if (profile.projects.length === 0) recommendations.push('Add at least 2-3 projects to showcase your work');
        if (!profile.linkedin && !profile.github) recommendations.push('Add LinkedIn or GitHub profile links');
        if (profile.experience === 0) recommendations.push('Add internship or project experience');
        if (profile.certs.length === 0) recommendations.push('Include relevant certifications');

        const recList = document.getElementById('ats-recommendations');
        recList.innerHTML = recommendations.map(rec => `<li>${rec}</li>`).join('');

        showToast(`ATS Score: ${this.atsScore}/100`, this.atsScore >= 70 ? 'success' : 'warning', 'ATS Analysis Complete');
      },

      optimizeKeywords() {
        const jobTitle = document.getElementById('target-job-title').value;
        if (!jobTitle) {
          showToast('Please enter a target job title', 'warning');
          return;
        }

        // Simulated keyword suggestions based on job title
        const keywordMap = {
          'software engineer': ['JavaScript', 'Python', 'Git', 'API', 'Agile', 'React', 'Node.js', 'SQL'],
          'data scientist': ['Python', 'Machine Learning', 'SQL', 'Statistics', 'TensorFlow', 'Pandas', 'R', 'Data Visualization'],
          'product manager': ['Roadmap', 'Stakeholder Management', 'Agile', 'User Stories', 'Analytics', 'MVP', 'A/B Testing'],
          'ui/ux designer': ['Figma', 'Sketch', 'User Research', 'Wireframing', 'Prototyping', 'Design Systems', 'Usability Testing']
        };

        const keywords = keywordMap[jobTitle.toLowerCase()] || ['Leadership', 'Communication', 'Problem Solving', 'Teamwork', 'Analytical'];

        const suggestionsDiv = document.getElementById('keyword-suggestions');
        const tagsDiv = document.getElementById('keyword-tags');

        tagsDiv.innerHTML = keywords.map(kw =>
          `<span style="background: #fef3c7; color: #92400e; padding: 6px 12px; border-radius: 16px; font-size: 12px; font-weight: 600; cursor: pointer;" class="keyword-tag" data-skill="${kw}">${kw}</span>`
        ).join('');

        suggestionsDiv.style.display = 'block';
        showToast(`Found ${keywords.length} keywords for ${jobTitle}`, 'success', 'Keywords Optimized');
      },

      addSkillToProfile(skill) {
        if (this.tagInputs['p-skills']) {
          this.tagInputs['p-skills'].addTag(skill);
          showToast(`Added "${skill}" to your skills`, 'success');
        }
      },

      saveResumeVersion() {
        if (!this.generatedResumeHTML) {
          showToast('Generate a resume first!', 'warning');
          return;
        }

        const version = {
          id: Date.now(),
          name: `Resume v${this.resumeVersions.length + 1}`,
          date: new Date().toLocaleDateString(),
          html: this.generatedResumeHTML,
          template: this.selectedTemplate
        };

        this.resumeVersions.push(version);
        this.renderResumeVersions();
        showToast('Resume version saved successfully!', 'success');
      },

      renderResumeVersions() {
        const container = document.getElementById('resume-versions-list');
        if (this.resumeVersions.length === 0) {
          container.innerHTML = '<div style="border: 2px dashed #e5e7eb; border-radius: 12px; padding: 20px; text-align: center; color: #9ca3af;"><div style="font-size: 32px; margin-bottom: 8px;">üìÑ</div><div style="font-size: 13px;">No saved versions yet</div></div>';
          return;
        }

        container.innerHTML = this.resumeVersions.map(v => `
          <div class="resume-version-item" data-id="${v.id}" style="border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; cursor: pointer; background: white;">
            <div style="font-size: 24px; margin-bottom: 8px;">üìÑ</div>
            <div style="font-weight: 600; font-size: 14px; color: #111827; margin-bottom: 4px;">${v.name}</div>
            <div style="font-size: 12px; color: #6b7280; margin-bottom: 8px;">${v.date}</div>
            <div style="font-size: 11px; color: #10b981; background: #f0fdf4; padding: 4px 8px; border-radius: 12px; display: inline-block;">${v.template}</div>
          </div>
        `).join('');
      },

      loadResumeVersion(id) {
        const version = this.resumeVersions.find(v => v.id === id);
        if (version) {
          this.generatedResumeHTML = version.html;
          document.getElementById('resume-preview').innerHTML = version.html;
          document.getElementById('download-resume-btn').disabled = false;
          showToast(`Loaded ${version.name}`, 'success');
        }
      },

      // NEW: Email Resume Modal
      showEmailModal() {
        if (!this.generatedResumeHTML) {
          showToast('Generate a resume first!', 'warning');
          return;
        }
        document.getElementById('email-resume-modal').style.display = 'flex';
        // Pre-fill subject
        const profile = this.getFullProfile();
        document.getElementById('email-subject').value = `Application - ${profile.name}`;
      },

      sendResumeEmail() {
        const email = document.getElementById('recipient-email').value;
        const subject = document.getElementById('email-subject').value;
        const message = document.getElementById('email-message').value;

        if (!email || !subject) {
          showToast('Please fill in recipient email and subject', 'warning');
          return;
        }

        // Simulate sending - in production, this would call backend API
        showToast('Sending resume...', 'info');

        setTimeout(() => {
          showToast(`Resume sent to ${email}!`, 'success', 'Email Sent');
          document.getElementById('email-resume-modal').style.display = 'none';
          // Clear form
          document.getElementById('recipient-email').value = '';
          document.getElementById('email-message').value = '';
        }, 1500);
      },

      // NEW: Switch between Resume and Cover Letter
      currentDocType: 'resume',

      switchDocumentType(type) {
        this.currentDocType = type;

        // Update tab styling
        document.querySelectorAll('.doc-type-tab').forEach(tab => {
          const isActive = tab.getAttribute('data-type') === type;
          tab.style.color = isActive ? 'var(--color-primary)' : '#6b7280';
          tab.style.borderBottom = isActive ? '3px solid var(--color-primary)' : '3px solid transparent';
        });

        // Toggle sections
        document.getElementById('resume-templates-section').style.display = type === 'resume' ? 'block' : 'none';
        document.getElementById('cover-letter-section').style.display = type === 'cover-letter' ? 'block' : 'none';

        // Update preview title
        const previewTitle = document.querySelector('#resume-preview').previousElementSibling;
        if (previewTitle) {
          previewTitle.querySelector('h3').textContent = type === 'resume' ? 'Preview' : 'Cover Letter Preview';
        }
      },

      // NEW: Generate Cover Letter
      generateCoverLetter() {
        const company = document.getElementById('cl-company').value;
        const jobTitle = document.getElementById('cl-job-title').value;
        const reason = document.getElementById('cl-reason').value;
        const tone = document.getElementById('cl-tone').value;

        if (!company || !jobTitle) {
          showToast('Please fill in company name and job title', 'warning');
          return;
        }

        const profile = this.getFullProfile();

        // Generate cover letter based on tone
        let opening = '';
        let closing = '';

        switch (tone) {
          case 'enthusiastic':
            opening = `I am thrilled to apply for the ${jobTitle} position at ${company}!`;
            closing = `I can't wait to bring my energy and passion to ${company}. Thank you for considering my application!`;
            break;
          case 'confident':
            opening = `I am writing to express my strong interest in the ${jobTitle} position at ${company}.`;
            closing = `I am confident that my skills and experience make me an ideal candidate for this role. I look forward to discussing this opportunity with you.`;
            break;
          case 'humble':
            opening = `I am honored to apply for the ${jobTitle} position at ${company}.`;
            closing = `I would be grateful for the opportunity to contribute to ${company}'s success. Thank you for your consideration.`;
            break;
          default:
            opening = `I am writing to apply for the ${jobTitle} position at ${company}.`;
            closing = `Thank you for considering my application. I look forward to the opportunity to discuss how I can contribute to ${company}.`;
        }

        const coverLetterHTML = `
          <div style="font-family: 'Inter', sans-serif; max-width: 700px; margin: 0 auto; padding: 40px; line-height: 1.8; color: #111827;">
            <!-- Header -->
            <div style="margin-bottom: 40px;">
              <div style="font-size: 24px; font-weight: 700; margin-bottom: 8px;">${profile.name}</div>
              <div style="font-size: 14px; color: #6b7280;">${profile.email}</div>
              ${profile.linkedin ? `<div style="font-size: 14px; color: #6b7280;">${profile.linkedin}</div>` : ''}
            </div>

            <!-- Date and Company -->
            <div style="margin-bottom: 32px;">
              <div style="font-size: 14px; color: #6b7280; margin-bottom: 16px;">${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>
              <div style="font-weight: 600;">${company}</div>
              <div style="color: #6b7280;">Hiring Manager</div>
            </div>

            <!-- Salutation -->
            <div style="margin-bottom: 24px;">
              <strong>Dear Hiring Manager,</strong>
            </div>

            <!-- Opening Paragraph -->
            <p style="margin-bottom: 20px;">
              ${opening} With my background in ${profile.major} and ${profile.experience} years of experience, I am excited to bring my skills and expertise to your team.
            </p>

            <!-- Body Paragraph -->
            <p style="margin-bottom: 20px;">
              Throughout my academic and professional journey, I have developed strong capabilities in ${profile.skills.slice(0, 3).join(', ')}${profile.skills.length > 3 ? ', and more' : ''}. My experience has equipped me with the technical skills and problem-solving abilities necessary to excel in the ${jobTitle} role.
            </p>

            ${reason ? `<p style="margin-bottom: 20px;">${reason}</p>` : ''}

            <!-- Achievements -->
            ${profile.achievements && profile.achievements.length > 0 ? `
              <p style="margin-bottom: 20px;">
                Some of my key accomplishments include:
              </p>
              <ul style="margin-bottom: 20px; padding-left: 20px;">
                ${profile.achievements.slice(0, 3).map(ach => `<li style="margin-bottom: 8px;">${ach}</li>`).join('')}
              </ul>
            ` : ''}

            <!-- Closing Paragraph -->
            <p style="margin-bottom: 32px;">
              ${closing}
            </p>

            <!-- Sign-off -->
            <div>
              <div style="margin-bottom: 48px;">Sincerely,</div>
              <div style="font-weight: 600;">${profile.name}</div>
            </div>
          </div>
        `;

        this.generatedResumeHTML = coverLetterHTML;
        document.getElementById('resume-preview').innerHTML = coverLetterHTML;
        document.getElementById('download-resume-btn').disabled = false;
        document.getElementById('email-resume-btn').disabled = false;

        showToast('Cover letter generated successfully!', 'success');
      },

      // NEW: LinkedIn Import

      getFullProfile() {
        return {
          name: document.getElementById('p-name')?.value || this.user?.username || 'Your Name',
          email: document.getElementById('p-email')?.value || this.user?.email || 'your.email@example.com',
          degree: document.getElementById('p-degree')?.value || 'Bachelor\'s Degree',
          major: document.getElementById('p-major')?.value || 'Computer Science',
          specialization: document.getElementById('p-specialization')?.value || '',
          cgpa: document.getElementById('p-cgpa')?.value || '0.0',
          experience: document.getElementById('p-experience')?.value || '0',
          skills: this.tagInputs['p-skills']?.getTags() || [],
          certs: this.tagInputs['p-certs']?.getTags() || [],
          linkedin: document.getElementById('p-linkedin')?.value || '',
          github: document.getElementById('p-github')?.value || '',
          portfolio: document.getElementById('p-portfolio')?.value || '',
          projects: this.getProjectsData(),
          achievements: this.getAchievementsData(),
          languages: this.getLanguagesData()
        };
      },

      generateResume() {
        // Get profile data
        const profile = this.getFullProfile();

        // Generate HTML based on template
        let resumeHTML = '';

        if (this.selectedTemplate === 'modern') {
          resumeHTML = this.generateModernResume(profile);
        } else if (this.selectedTemplate === 'classic') {
          resumeHTML = this.generateClassicResume(profile);
        } else {
          resumeHTML = this.generateCreativeResume(profile);
        }

        this.generatedResumeHTML = resumeHTML;
        document.getElementById('resume-preview').innerHTML = resumeHTML;
        document.getElementById('download-resume-btn').disabled = false;
        document.getElementById('email-resume-btn').disabled = false;
        showToast('Resume generated successfully!', 'success');
      },

      generateModernResume(profile) {
        return `
          <div style="font-family: 'Inter', sans-serif; max-width: 800px; margin: 0 auto; line-height: 1.6; color: #111827;">
            <!-- Header -->
            <div style="background: linear-gradient(135deg, var(--color-primary) 0%, #059669 100%); color: white; padding: 40px; border-radius: 8px 8px 0 0; margin-bottom: 30px;">
              <h1 style="margin: 0 0 8px 0; font-size: 36px; font-weight: 700;">${profile.name}</h1>
              <div style="font-size: 16px; opacity: 0.95; margin-bottom: 16px;">${profile.major}${profile.specialization ? ' - ' + profile.specialization : ''}</div>
              <div style="display: flex; flex-wrap: wrap; gap: 20px; font-size: 14px; opacity: 0.9; margin-bottom: 12px;">
                <span>üìß ${profile.email}</span>
                <span>üéì ${profile.degree}</span>
                <span>üìä CGPA: ${profile.cgpa}</span>
                <span>üíº ${profile.experience} years exp</span>
              </div>
              ${profile.linkedin || profile.github || profile.portfolio ? `
              <div style="display: flex; gap: 16px; font-size: 13px; opacity: 0.9; flex-wrap: wrap;">
                ${profile.linkedin ? `<span>üîó LinkedIn: ${profile.linkedin}</span>` : ''}
                ${profile.github ? `<span>üíª GitHub: ${profile.github}</span>` : ''}
                ${profile.portfolio ? `<span>üåê Portfolio: ${profile.portfolio}</span>` : ''}
              </div>
              ` : ''}
            </div>

            <!-- Skills -->
            ${profile.skills.length > 0 ? `
            <div style="margin-bottom: 30px;">
              <h2 style="font-size: 20px; font-weight: 700; color: var(--color-primary); margin-bottom: 12px; border-bottom: 2px solid var(--color-primary); padding-bottom: 8px;">üí° Skills</h2>
              <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                ${profile.skills.map(skill => `<span style="background: #f0fdf4; color: #166534; padding: 6px 14px; border-radius: 20px; font-size: 14px; font-weight: 500; border: 1px solid #bbf7d0;">${skill}</span>`).join('')}
              </div>
            </div>
            ` : ''}

            <!-- Education -->
            <div style="margin-bottom: 30px;">
              <h2 style="font-size: 20px; font-weight: 700; color: var(--color-primary); margin-bottom: 12px; border-bottom: 2px solid var(--color-primary); padding-bottom: 8px;">üéì Education</h2>
              <div style="margin-bottom: 12px;">
                <div style="font-weight: 600; font-size: 16px; color: #111827;">${profile.degree} in ${profile.major}</div>
                ${profile.specialization ? `<div style="color: #6b7280; font-size: 14px;">Specialization: ${profile.specialization}</div>` : ''}
                <div style="color: #6b7280; font-size: 14px;">CGPA: ${profile.cgpa}/10.0</div>
              </div>
            </div>

            <!-- Experience -->
            <div style="margin-bottom: 30px;">
              <h2 style="font-size: 20px; font-weight: 700; color: var(--color-primary); margin-bottom: 12px; border-bottom: 2px solid var(--color-primary); padding-bottom: 8px;">üíº Experience</h2>
              <div style="color: #374151; font-size: 14px;">
                ${profile.experience > 0 ? `${profile.experience} years of professional experience in ${profile.major}` : 'Fresher - Ready to start my career journey'}
              </div>
            </div>

            <!-- Projects -->
            ${profile.projects && profile.projects.length > 0 ? `
            <div style="margin-bottom: 30px;">
              <h2 style="font-size: 20px; font-weight: 700; color: var(--color-primary); margin-bottom: 12px; border-bottom: 2px solid var(--color-primary); padding-bottom: 8px;">üíº Projects</h2>
              ${profile.projects.map(proj => `
                <div style="margin-bottom: 16px;">
                  <div style="font-weight: 600; font-size: 16px; color: #111827; margin-bottom: 4px;">${proj.title}</div>
                  ${proj.description ? `<div style="color: #6b7280; font-size: 14px; margin-bottom: 4px;">${proj.description}</div>` : ''}
                  ${proj.technologies ? `<div style="font-size: 13px; color: #059669; margin-bottom: 4px;"><strong>Technologies:</strong> ${proj.technologies}</div>` : ''}
                  ${proj.link ? `<div style="font-size: 13px; color: #2563eb;"><a href="${proj.link}" style="color: #2563eb;">üîó View Project</a></div>` : ''}
                </div>
              `).join('')}
            </div>
            ` : ''}

            <!-- Certifications -->
            ${profile.certs.length > 0 ? `
            <div style="margin-bottom: 30px;">
              <h2 style="font-size: 20px; font-weight: 700; color: var(--color-primary); margin-bottom: 12px; border-bottom: 2px solid var(--color-primary); padding-bottom: 8px;">üèÜ Certifications</h2>
              <ul style="margin: 0; padding-left: 20px; color: #374151;">
                ${profile.certs.map(cert => `<li style="margin-bottom: 8px;">${cert}</li>`).join('')}
              </ul>
            </div>
            ` : ''}

            <!-- Achievements -->
            ${profile.achievements && profile.achievements.length > 0 ? `
            <div style="margin-bottom: 30px;">
              <h2 style="font-size: 20px; font-weight: 700; color: var(--color-primary); margin-bottom: 12px; border-bottom: 2px solid var(--color-primary); padding-bottom: 8px;">üåü Achievements</h2>
              <ul style="margin: 0; padding-left: 20px; color: #374151;">
                ${profile.achievements.map(ach => `<li style="margin-bottom: 8px;">${ach}</li>`).join('')}
              </ul>
            </div>
            ` : ''}

            <!-- Languages -->
            ${profile.languages && profile.languages.length > 0 ? `
            <div style="margin-bottom: 30px;">
              <h2 style="font-size: 20px; font-weight: 700; color: var(--color-primary); margin-bottom: 12px; border-bottom: 2px solid var(--color-primary); padding-bottom: 8px;">üåç Languages</h2>
              <div style="display: flex; flex-wrap: wrap; gap: 12px;">
                ${profile.languages.map(lang => `<span style="background: #f0fdf4; color: #166534; padding: 8px 14px; border-radius: 20px; font-size: 14px; font-weight: 500; border: 1px solid #bbf7d0;">${lang.name} - ${lang.level}</span>`).join('')}
              </div>
            </div>
            ` : ''}
          </div>
        `;
      },

      generateClassicResume(profile) {
        return `
          <div style="font-family: 'Times New Roman', serif; max-width: 800px; margin: 0 auto; line-height: 1.8; color: #000;">
            <div style="text-align: center; border-bottom: 3px solid #000; padding-bottom: 20px; margin-bottom: 30px;">
              <h1 style="margin: 0 0 10px 0; font-size: 32px; font-weight: bold; text-transform: uppercase;">${profile.name}</h1>
              <div style="font-size: 14px;">${profile.email} | ${profile.degree} | CGPA: ${profile.cgpa}</div>
            </div>

            <div style="margin-bottom: 25px;">
              <h2 style="font-size: 18px; font-weight: bold; text-transform: uppercase; border-bottom: 2px solid #000; padding-bottom: 5px; margin-bottom: 15px;">Education</h2>
              <div><strong>${profile.degree}</strong> in ${profile.major}</div>
              ${profile.specialization ? `<div>Specialization: ${profile.specialization}</div>` : ''}
              <div>CGPA: ${profile.cgpa}/10.0</div>
            </div>

            ${profile.skills.length > 0 ? `
            <div style="margin-bottom: 25px;">
              <h2 style="font-size: 18px; font-weight: bold; text-transform: uppercase; border-bottom: 2px solid #000; padding-bottom: 5px; margin-bottom: 15px;">Skills</h2>
              <div>${profile.skills.join(', ')}</div>
            </div>
            ` : ''}

            <div style="margin-bottom: 25px;">
              <h2 style="font-size: 18px; font-weight: bold; text-transform: uppercase; border-bottom: 2px solid #000; padding-bottom: 5px; margin-bottom: 15px;">Experience</h2>
              <div>${profile.experience > 0 ? `${profile.experience} years of experience` : 'Fresher'}</div>
            </div>

            ${profile.certs.length > 0 ? `
            <div style="margin-bottom: 25px;">
              <h2 style="font-size: 18px; font-weight: bold; text-transform: uppercase; border-bottom: 2px solid #000; padding-bottom: 5px; margin-bottom: 15px;">Certifications</h2>
              <ul style="margin: 0; padding-left: 20px;">
                ${profile.certs.map(cert => `<li>${cert}</li>`).join('')}
              </ul>
            </div>
            ` : ''}
          </div>
        `;
      },

      generateCreativeResume(profile) {
        return `
          <div style="font-family: 'Inter', sans-serif; max-width: 800px; margin: 0 auto; line-height: 1.6;">
            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 30px;">
              <!-- Sidebar -->
              <div style="background: linear-gradient(180deg, #7c3aed 0%, #5b21b6 100%); color: white; padding: 30px; border-radius: 12px;">
                <div style="text-align: center; margin-bottom: 30px;">
                  <div style="width: 100px; height: 100px; background: white; border-radius: 50%; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center; font-size: 40px; color: #7c3aed; font-weight: bold;">
                    ${profile.name.charAt(0)}
                  </div>
                  <h2 style="margin: 0; font-size: 20px;">${profile.name}</h2>
                </div>

                <div style="margin-bottom: 25px;">
                  <h3 style="font-size: 14px; font-weight: 700; margin-bottom: 12px; opacity: 0.9;">CONTACT</h3>
                  <div style="font-size: 13px; opacity: 0.85; line-height: 1.8;">
                    <div>üìß ${profile.email}</div>
                    <div>üéì ${profile.degree}</div>
                    <div>üìä ${profile.cgpa} CGPA</div>
                  </div>
                </div>

                ${profile.skills.length > 0 ? `
                <div>
                  <h3 style="font-size: 14px; font-weight: 700; margin-bottom: 12px; opacity: 0.9;">SKILLS</h3>
                  <div style="font-size: 12px; opacity: 0.85;">
                    ${profile.skills.map(skill => `<div style="background: rgba(255,255,255,0.2); padding: 6px 10px; border-radius: 12px; margin-bottom: 6px;">${skill}</div>`).join('')}
                  </div>
                </div>
                ` : ''}
              </div>

              <!-- Main Content -->
              <div style="padding: 30px 0;">
                <div style="margin-bottom: 30px;">
                  <h1 style="font-size: 28px; font-weight: 700; color: #7c3aed; margin-bottom: 8px;">${profile.major}</h1>
                  <div style="color: #6b7280; font-size: 16px;">${profile.specialization || 'Specialist'}</div>
                </div>

                <div style="margin-bottom: 30px;">
                  <h2 style="font-size: 18px; font-weight: 700; color: #111827; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #7c3aed;">Education</h2>
                  <div style="font-weight: 600; color: #111827; margin-bottom: 4px;">${profile.degree} in ${profile.major}</div>
                  ${profile.specialization ? `<div style="color: #6b7280; font-size: 14px;">Specialization: ${profile.specialization}</div>` : ''}
                  <div style="color: #6b7280; font-size: 14px;">CGPA: ${profile.cgpa}/10.0</div>
                </div>

                <div style="margin-bottom: 30px;">
                  <h2 style="font-size: 18px; font-weight: 700; color: #111827; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #7c3aed;">Experience</h2>
                  <div style="color: #374151;">${profile.experience > 0 ? `${profile.experience} years of professional experience` : 'Fresher - Eager to learn and grow'}</div>
                </div>

                ${profile.certs.length > 0 ? `
                <div>
                  <h2 style="font-size: 18px; font-weight: 700; color: #111827; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #7c3aed;">Certifications</h2>
                  <ul style="margin: 0; padding-left: 20px; color: #374151;">
                    ${profile.certs.map(cert => `<li style="margin-bottom: 8px;">${cert}</li>`).join('')}
                  </ul>
                </div>
                ` : ''}
              </div>
            </div>
          </div>
        `;
      },

      downloadResume() {
        if (!this.generatedResumeHTML) {
          showToast('Please generate a resume first!', 'warning');
          return;
        }

        // Create a printable version
        const printWindow = window.open('', '_blank');
        const resumeContent = `<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Resume - ${this.user?.username || 'User'}</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}
html {
  margin: 0;
  padding: 0;
}
body {
  margin: 0;
  padding: 15px;
  font-family: 'Inter', sans-serif;
  background: white;
  -webkit-print-color-adjust: exact;
  print-color-adjust: exact;
}
@media print {
  html, body {
    margin: 0 !important;
    padding: 0 !important;
    width: 100%;
    height: 100%;
  }
  body {
    padding: 0 !important;
  }
  @page {
    margin: 0.5cm;
  }
}
@media screen {
  body {
    max-width: 850px;
    margin: 0 auto;
    padding: 20px;
  }
}
</style>
</head>
<body>${this.generatedResumeHTML}
<script>
window.onload = function() {
  setTimeout(function() {
    window.print();
  }, 500);
};
<\/script>
</body>
</html>`;
        printWindow.document.write(resumeContent);
        printWindow.document.close();
      },

      async generatePrediction() {
        const btn = document.querySelector('#predict-form button[type="submit"]');
        const originalText = btn.textContent;
        btn.textContent = 'Analyzing...';
        btn.disabled = true;

        try {
          const payload = {
            degree: document.getElementById('pr-degree').value,
            major: document.getElementById('pr-major').value,
            specialization: document.getElementById('pr-specialization').value,
            cgpa: document.getElementById('pr-cgpa').value,
            years_of_experience: document.getElementById('pr-experience').value,
            preferred_industry: document.getElementById('pr-industry').value,
            skills: this.tagInputs['pr-skills'].getTags().join(','),
            certifications: this.tagInputs['pr-certs'].getTags().join(',')
          };

          const res = await fetch(`${API_BASE_URL}/api/predict-job`, {
            method: 'POST',
            headers: this.getHeaders(),
            body: JSON.stringify(payload)
          });

          if (res.status === 401) {
            this.logout();
            return;
          }

          const data = await res.json();

          if (data.success) {
            this.renderPredictionResult(data);
            this.loadHistory(); // Refresh history
          } else {
            showToast('Prediction failed: ' + data.message, 'error');
          }

        } catch (e) {
          console.error('Prediction error', e);
          showToast('An error occurred while generating prediction.', 'error');
        } finally {
          btn.textContent = originalText;
          btn.disabled = false;
        }
      },

      renderPredictionResult(data) {
        document.getElementById('prediction-output').style.display = 'block';

        // Animate Confidence Gauge
        const confidence = data.match_percentage;
        const circumference = 2 * Math.PI * 75; // radius = 75
        const offset = circumference - (confidence / 100) * circumference;

        setTimeout(() => {
          document.getElementById('confidence-progress').style.strokeDashoffset = offset;
        }, 100);

        document.getElementById('res-confidence').textContent = confidence + '%';

        // Set confidence label with color coding
        const confidenceLabel = document.getElementById('confidence-label');
        if (confidence >= 80) {
          confidenceLabel.textContent = 'üéØ Highly Confident Match';
          confidenceLabel.style.background = '#dcfce7';
          confidenceLabel.style.color = '#16a34a';
        } else if (confidence >= 60) {
          confidenceLabel.textContent = '‚ú® Good Match';
          confidenceLabel.style.background = '#fef3c7';
          confidenceLabel.style.color = '#d97706';
        } else {
          confidenceLabel.textContent = 'üí° Potential Career Path';
          confidenceLabel.style.background = '#fee2e2';
          confidenceLabel.style.color = '#dc2626';
        }

        // Role and Description
        document.getElementById('res-role').textContent = data.predicted_role;
        document.getElementById('res-salary').textContent = data.salary_range;
        document.getElementById('res-description').textContent = data.description || 'No description available for this role.';
        document.getElementById('res-growth').textContent = data.growth_rate || 'Stable';

        // Set demand (simulated based on confidence)
        const demandEl = document.getElementById('res-demand');
        if (confidence >= 75) {
          demandEl.textContent = 'Very High';
        } else if (confidence >= 50) {
          demandEl.textContent = 'High';
        } else {
          demandEl.textContent = 'Moderate';
        }

        // Career Progression Timeline
        this.renderCareerTimeline(data);

        // Missing Skills
        const missingContainer = document.getElementById('res-missing-skills');
        missingContainer.innerHTML = '';
        if (data.skill_gap_analysis && data.skill_gap_analysis.length > 0) {
          data.skill_gap_analysis.forEach(skill => {
            const tag = document.createElement('span');
            tag.style.cssText = 'background: #fef2f2; color: #dc2626; padding: 8px 14px; border-radius: 20px; font-size: 13px; border: 1px solid #fecaca; font-weight: 500;';
            tag.textContent = skill;
            missingContainer.appendChild(tag);
          });
        } else {
          missingContainer.innerHTML = '<span style="color: #10b981; font-size: 14px; font-weight: 500;">üéâ Great match! No major skill gaps.</span>';
        }

        // Recommended Certs
        const certsContainer = document.getElementById('res-certs');
        certsContainer.innerHTML = '';
        if (data.certifications && data.certifications.length > 0) {
          data.certifications.forEach(cert => {
            const li = document.createElement('li');
            li.textContent = cert;
            li.style.marginBottom = '6px';
            certsContainer.appendChild(li);
          });
        } else {
          certsContainer.innerHTML = '<li>No specific certifications required.</li>';
        }

        // Update Negotiation Tips
        const negRole = document.getElementById('neg-role');
        const negSkill = document.getElementById('neg-skill');
        if (negRole) negRole.textContent = data.predicted_role;
        if (negSkill) {
          // Use first skill from profile or input
          const skills = this.tagInputs['pr-skills'].getTags();
          negSkill.textContent = skills.length > 0 ? skills[0] : 'your expertise';
        }

        // Alternative Careers Matrix
        this.renderAlternativesMatrix(data.top_alternative_roles || []);

        // Roadmap
        const roadmapContainer = document.getElementById('res-roadmap');
        roadmapContainer.innerHTML = '';
        if (data.roadmap && data.roadmap.length > 0) {
          data.roadmap.forEach(step => {
            const stepDiv = document.createElement('div');
            stepDiv.className = 'roadmap-step';
            stepDiv.innerHTML = `
<div class="step-number">${step.step}</div>
<div class="step-content">
  <div class="step-title">${step.title}</div>
  <div class="step-desc">${step.desc}</div>
</div>
`;
            roadmapContainer.appendChild(stepDiv);
          });
        } else {
          roadmapContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: #9ca3af;">No roadmap available for this role.</div>';
        }

        this.renderCharts(data);
        document.getElementById('prediction-output').scrollIntoView({ behavior: 'smooth' });
      },

      renderCareerTimeline(data) {
        const timeline = document.getElementById('career-timeline');
        const milestones = [
          { level: 'Entry Level', years: '0-2 years', salary: '‚Çπ5L-‚Çπ8L', skills: 'Foundation skills' },
          { level: 'Mid Level', years: '2-5 years', salary: '‚Çπ8L-‚Çπ15L', skills: 'Advanced expertise' },
          { level: 'Senior Level', years: '5-8 years', salary: '‚Çπ15L-‚Çπ25L', skills: 'Leadership & Strategy' },
          { level: 'Lead/Principal', years: '8+ years', salary: '‚Çπ25L-‚Çπ50L+', skills: 'Vision & Innovation' }
        ];

        timeline.innerHTML = `
<div style="position: relative;">
  <div
    style="position: absolute; top: 30px; left: 0; right: 0; height: 4px; background: linear-gradient(to right, var(--color-primary) 0%, #059669 50%, #065f46 100%); border-radius: 2px;">
  </div>
  <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; position: relative;">
    ${milestones.map((milestone, idx) => `
    <div style="text-align: center; animation: fadeInUp 0.6s ease-out ${idx * 0.1}s both;">
      <div
        style="width: 60px; height: 60px; margin: 0 auto 16px; background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 18px; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); position: relative; z-index: 1;">
        ${idx + 1}
      </div>
      <div style="background: #f9fafb; padding: 16px; border-radius: 12px; border: 1px solid #e5e7eb;">
        <div style="font-weight: 700; font-size: 15px; color: #111827; margin-bottom: 8px;">${milestone.level}</div>
        <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">‚è±Ô∏è ${milestone.years}</div>
        <div style="font-size: 13px; color: #10b981; font-weight: 600; margin-bottom: 4px;">${milestone.salary}</div>
        <div style="font-size: 11px; color: #9ca3af;">${milestone.skills}</div>
      </div>
    </div>
    `).join('')}
  </div>
</div>
`;
      },

      renderAlternativesMatrix(alternatives) {
        const matrix = document.getElementById('alternatives-matrix');

        if (!alternatives || alternatives.length === 0) {
          matrix.innerHTML = '<div style="text-align: center; padding: 40px; color: #9ca3af;">No alternative careers available.</div>';
          return;
        }

        // Ensure at least 3 alternatives are shown
        const minAlternatives = 3;
        if (alternatives.length < minAlternatives) {
          // Add placeholder alternatives if needed
          const placeholders = [
            { role: 'Data Analyst', match_percentage: 75, reason: 'analytical skills' },
            { role: 'Business Analyst', match_percentage: 72, reason: 'problem-solving abilities' },
            { role: 'Product Manager', match_percentage: 70, reason: 'strategic thinking' }
          ];
          while (alternatives.length < minAlternatives) {
            alternatives.push(placeholders[alternatives.length]);
          }
        }
        this.alternativesData = alternatives.map((alt, idx) => ({
          ...alt,
          demand: ['Very High', 'High', 'Moderate', 'Low'][idx % 4],
          growth: ['15%', '12%', '10%', '8%'][idx % 4]
        }));

        this.renderAlternativesTable();

        // Add sort listener
        document.getElementById('sort-alternatives').addEventListener('change', (e) => {
          this.sortAlternatives(e.target.value);
        });
      },

      renderAlternativesTable() {
        const matrix = document.getElementById('alternatives-matrix');
        const data = this.alternativesData || [];

        matrix.innerHTML = `
  <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden;">
    <thead>
      <tr style="background: #f9fafb; border-bottom: 2px solid #e5e7eb;">
        <th
          style="padding: 16px; text-align: left; font-size: 13px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">
          Role</th>
        <th
          style="padding: 16px; text-align: center; font-size: 13px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">
          Match</th>
        <th
          style="padding: 16px; text-align: center; font-size: 13px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">
          Demand</th>
        <th
          style="padding: 16px; text-align: center; font-size: 13px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">
          Growth</th>
        <th
          style="padding: 16px; text-align: left; font-size: 13px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px;">
          Why This Role?</th>
      </tr>
    </thead>
    <tbody>
      ${data.map((alt, idx) => `
      <tr style="border-bottom: 1px solid #f3f4f6; transition: background 0.2s;"
        onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
        <td style="padding: 16px;">
          <div style="font-weight: 600; color: #111827; font-size: 15px; margin-bottom: 4px;">${alt.role}</div>
          <div style="font-size: 12px; color: #6b7280;">Alternative path ${idx + 1}</div>
        </td>
        <td style="padding: 16px; text-align: center;">
          <div
            style="display: inline-flex; align-items: center; gap: 8px; background: #eff6ff; padding: 6px 12px; border-radius: 20px; border: 1px solid #bfdbfe;">
            <div style="font-weight: 700; color: #2563eb; font-size: 14px;">${alt.match_percentage}%</div>
          </div>
        </td>
        <td style="padding: 16px; text-align: center;">
          <span
            style="background: ${alt.demand === 'Very High' ? '#dcfce7' : alt.demand === 'High' ? '#fef3c7' : '#f3f4f6'}; color: ${alt.demand === 'Very High' ? '#16a34a' : alt.demand === 'High' ? '#d97706' : '#6b7280'}; padding: 6px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;">
            ${alt.demand}
          </span>
        </td>
        <td style="padding: 16px; text-align: center;">
          <div style="font-weight: 600; color: #10b981; font-size: 14px;">+${alt.growth}</div>
        </td>
        <td style="padding: 16px;">
          <div style="font-size: 13px; color: #6b7280; line-height: 1.5;">
            Strong alignment with your ${alt.reason || 'skills and experience'}
          </div>
        </td>
      </tr>
      `).join('')}
    </tbody>
  </table>
  `;
      },

      sortAlternatives(criteria) {
        if (!this.alternativesData) return;

        const sorted = [...this.alternativesData];
        switch (criteria) {
          case 'match':
            sorted.sort((a, b) => b.match_percentage - a.match_percentage);
            break;
          case 'demand':
            const demandOrder = { 'Very High': 4, 'High': 3, 'Moderate': 2, 'Low': 1 };
            sorted.sort((a, b) => demandOrder[b.demand] - demandOrder[a.demand]);
            break;
          case 'growth':
            sorted.sort((a, b) => parseInt(b.growth) - parseInt(a.growth));
            break;
        }
        this.alternativesData = sorted;
        this.renderAlternativesTable();
      },

      renderCharts(data) {
        if (this.charts.skill) this.charts.skill.destroy();
        if (this.charts.conf) this.charts.conf.destroy();

        // Calculate derived scores for visualization
        const techScore = data.match_percentage; // Proxy for tech skills
        const expScore = Math.min(100, (parseFloat(document.getElementById('pr-experience').value) / 5) * 100);
        const eduScore = 90; // Assume high for now
        const industryScore = 85; // Assume high for now
        const softScore = 80;

        // Enhanced Skill Chart (Multi-layer Radar)
        const ctxSkill = document.getElementById('skillChart').getContext('2d');
        this.charts.skill = new Chart(ctxSkill, {
          type: 'radar',
          data: {
            labels: ['Tech Skills', 'Experience', 'Education', 'Industry Fit', 'Soft Skills'],
            datasets: [
              {
                label: 'Your Skills',
                data: [techScore, expScore, eduScore, industryScore, softScore],
                backgroundColor: 'rgba(16, 185, 129, 0.2)',
                borderColor: 'var(--color-primary)',
                borderWidth: 3,
                pointBackgroundColor: 'var(--color-primary)',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointRadius: 5,
                pointHoverRadius: 7
              },
              {
                label: 'Required Level',
                data: [85, 70, 80, 75, 85],
                backgroundColor: 'rgba(5, 150, 105, 0.1)',
                borderColor: '#059669',
                borderWidth: 2,
                borderDash: [5, 5],
                pointBackgroundColor: '#059669',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointRadius: 4,
                pointHoverRadius: 6
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              r: {
                beginAtZero: true,
                max: 100,
                ticks: {
                  display: true,
                  stepSize: 25,
                  font: { size: 11 },
                  color: '#9ca3af'
                },
                grid: { color: '#e5e7eb' },
                pointLabels: {
                  font: { size: 13, weight: '600' },
                  color: '#374151'
                }
              }
            },
            plugins: {
              legend: {
                display: true,
                position: 'bottom',
                labels: {
                  padding: 15,
                  font: { size: 12, weight: '500' },
                  usePointStyle: true,
                  pointStyle: 'circle'
                }
              },
              tooltip: {
                backgroundColor: '#1f2937',
                padding: 12,
                titleFont: { size: 13, weight: '600' },
                bodyFont: { size: 12 },
                cornerRadius: 8
              }
            }
          }
        });

        // Enhanced Confidence Chart (Horizontal Bar)
        const ctxConf = document.getElementById('confidenceChart').getContext('2d');
        this.charts.conf = new Chart(ctxConf, {
          type: 'bar',
          data: {
            labels: ['Your Match', 'Market Average', 'Top 10% Candidates'],
            datasets: [{
              label: 'Match Score',
              data: [data.match_percentage, 65, 92],
              backgroundColor: [
                'rgba(16, 185, 129, 0.9)',
                'rgba(229, 231, 235, 0.8)',
                'rgba(5, 150, 105, 0.6)'
              ],
              borderColor: [
                'var(--color-primary)',
                '#e5e7eb',
                '#059669'
              ],
              borderWidth: 2,
              borderRadius: 8,
              borderSkipped: false
            }]
          },
          options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: {
                beginAtZero: true,
                max: 100,
                grid: { display: true, color: '#f3f4f6' },
                ticks: {
                  font: { size: 11 },
                  color: '#6b7280',
                  callback: function (value) {
                    return value + '%';
                  }
                }
              },
              y: {
                grid: { display: false },
                ticks: {
                  font: { size: 13, weight: '500' },
                  color: '#374151'
                }
              }
            },
            plugins: {
              legend: { display: false },
              tooltip: {
                backgroundColor: '#1f2937',
                padding: 12,
                titleFont: { size: 13, weight: '600' },
                bodyFont: { size: 12 },
                cornerRadius: 8,
                callbacks: {
                  label: function (context) {
                    return 'Score: ' + context.parsed.x + '%';
                  }
                }
              }
            }
          }
        });
      }
    };

    // --- INITIALIZATION & AUTHENTICATION ---
    (async function () {
      const authLoading = document.getElementById('auth-loading');

      // Use shared checkAuth utility
      const isAuthenticated = await Utils.checkAuth(true);
      if (!isAuthenticated) return;

      // Token is valid - get user info
      let user = JSON.parse(localStorage.getItem('userInfo'));
      if (!user) {
        // Fallback if userInfo is missing but token is valid
        const token = localStorage.getItem('authToken');
        const res = await fetch(`${CONFIG.API_BASE_URL}/verify-token`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const data = await res.json();
        user = {
          username: data.user_id || 'User',
          email: data.email || data.user_id || 'user@example.com'
        };
        localStorage.setItem('userInfo', JSON.stringify(user));
      }

      // Initialize app
      if (typeof window.app !== 'undefined') {
        window.app.init(user);

        // Show authenticated content
        document.body.classList.add('authenticated');
        if (authLoading) {
          authLoading.classList.add('hidden');
        }
      } else {
        console.error('App not defined');
        Utils.showToast('Application failed to initialize', 'error');
      }
    })();

    // Keyboard Shortcuts
    document.addEventListener('keydown', (e) => {
      // Ctrl/Cmd + P: Quick Predict
      if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
        e.preventDefault();
        window.app.nav('predict');
        showToast('Navigated to Predict', 'info');
      }

      // Ctrl/Cmd + S: Save Profile (when on profile page)
      if ((e.ctrlKey || e.metaKey) && e.key === 's') {
        e.preventDefault();
        const profileSection = document.getElementById('profile');
        if (profileSection && !profileSection.classList.contains('section')) {
          document.getElementById('profile-form-submit')?.click();
        }
      }

      // Ctrl/Cmd + H: Go to Home
      if ((e.ctrlKey || e.metaKey) && e.key === 'h') {
        e.preventDefault();
        window.app.nav('home');
        showToast('Navigated to Home', 'info');
      }

      // Ctrl/Cmd + R: Go to Resume Builder
      if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
        e.preventDefault();
        window.app.nav('resume');
        showToast('Navigated to Resume Builder', 'info');
      }

      // Esc: Close modals
      if (e.key === 'Escape') {
        const modal = document.getElementById('resume-preview-modal');
        if (modal && modal.style.display !== 'none') {
          modal.style.display = 'none';
        }
      }
    });

    // Show keyboard shortcuts hint on first load
    if (!localStorage.getItem('keyboard_shortcuts_shown')) {
      setTimeout(() => {
        showToast('üí° Tip: Use Ctrl+P (Predict), Ctrl+H (Home), Ctrl+R (Resume)', 'info', 'Keyboard Shortcuts');
        localStorage.setItem('keyboard_shortcuts_shown', 'true');
      }, 3000);
    }
  </script>
</body>

</html>